{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Vestibular platform for head-fixed mice Overview This device provides vestibular stimulation for head-fixed experiments in mice. It can be combined with different physiological and behavioural recording modalities. It follows a modular, low-cost and open-source model. This documentation provides the assembly and operation guide for users with some experience in rapid manufacturing, electronics and development boards/microcontrollers (such as Arduino). Figure 1. Global view of the setup and main components Features fully open source low cost easy to assemble modular design, modules can be added depending on experimental needs Main components The main components of the stage are labeled in the figure above. The rotary platform is actuated by a stepper motor using a timing belt. An incremental encoder is coupled with the motor shaft to measure the angular position and a Hall effect sensor is used for homing purposes. Compressed air is used to keep a polystyrene sphere floating without friction inside the sphere holder. The crossed roller bearing holds the rotating and non-rotating parts together. The rotary joint enables multiple electric connections between the rotary platform and the base. The device is intended to be used for behavioural experiments combined with extracellular recording and optogenetics. There are two operating modes: closed-loop and open-loop. In closed-loop, the rotation of the sphere on the vertical (yaw) axis is measured using an optical sensor and is used to generate a motor rotation of an adjustable magnitude in the opposite direction. In open-loop mode, motor rotation is independent of the animal\u2019s movement and can be controlled by the experimenter.","title":"Home"},{"location":"#vestibular-platform-for-head-fixed-mice","text":"","title":"Vestibular platform for head-fixed mice"},{"location":"#overview","text":"This device provides vestibular stimulation for head-fixed experiments in mice. It can be combined with different physiological and behavioural recording modalities. It follows a modular, low-cost and open-source model. This documentation provides the assembly and operation guide for users with some experience in rapid manufacturing, electronics and development boards/microcontrollers (such as Arduino). Figure 1. Global view of the setup and main components","title":"Overview"},{"location":"#features","text":"fully open source low cost easy to assemble modular design, modules can be added depending on experimental needs","title":"Features"},{"location":"#main-components","text":"The main components of the stage are labeled in the figure above. The rotary platform is actuated by a stepper motor using a timing belt. An incremental encoder is coupled with the motor shaft to measure the angular position and a Hall effect sensor is used for homing purposes. Compressed air is used to keep a polystyrene sphere floating without friction inside the sphere holder. The crossed roller bearing holds the rotating and non-rotating parts together. The rotary joint enables multiple electric connections between the rotary platform and the base. The device is intended to be used for behavioural experiments combined with extracellular recording and optogenetics. There are two operating modes: closed-loop and open-loop. In closed-loop, the rotation of the sphere on the vertical (yaw) axis is measured using an optical sensor and is used to generate a motor rotation of an adjustable magnitude in the opposite direction. In open-loop mode, motor rotation is independent of the animal\u2019s movement and can be controlled by the experimenter.","title":"Main components"},{"location":"characterization/characterization/","text":"The rotary stage's accuracy and repeatability have been evaluated by recording the angle (\u00b0) of the incremental encoder (2400 pulses per revolution) and the angle obtained from the teensystep step counter simultaneously. Figure 1 shows one of many tests made to evaluate the stage performance, in this case without the load of the head holder. The stage is repeatly sent to the set point positions (0 and 360 degrees). The results obtained are 360.06 \u00b1 0.11\u00b0 and 0.04 \u00b1 0.07\u00b0. Figure 1. Rotary stage performance Data and code for this characterization are available here Minimum incremental motion (MIM) and backlash The Minimum incremental motion reliably measured corresponds to 0.1 degrees. The backlash observed in the worst case scenario corresponding to the offset created on the change in direction of the MIM test has been 0.04 degrees. Figure 2. Minimum incremental motion Data and code for this characterization are available here Accuracy and repeatability In order to evaluate the accuracy and repeatability of the rotary stage, a sequence of increments of 45 degrees in both rotation directions has been performed, collecting 8 position deviations in each direction (16 per each velocity/acceleration condition). The overall accuracy and repeatability have been calculated from all conditions according to the following equations (https://www.newport.com/n/motion-basics-terminology-and-standards). Accuracy: Repeatability: Figure 3. Accuracy and repeatability test sequence (a) and average of absolute position deviation in every angular velocity and acceleration condition (b) Closed-loop characterization For the closed loop algorithm, the stability of the system response has been evaluated by the analysis of the step response for all previously described conditions (20-100 \u00b0\u00b7s\u00af\u00b9 and 200-1200 \u00b0\u00b7s\u00af\u00b2). From that a contour plot has been extracted to be used as a map to avoid regions of inaccuracy and instability. Sometimes event achieving a small error the stage can overshoot as shown in figure 4b. On figures 4c and 4d are shown the regions to avoid errors and instabilities around the set point. Figure 4. Step functions at 20 \u00b0\u00b7s\u00af\u00b9 /200 \u00b0\u00b7s\u00af\u00b2 and 100 \u00b0\u00b7s\u00af\u00b9 /1200 \u00b0\u00b7s\u00af\u00b2 (Figures a and b respectively). Accuracy and repeatability test sequence (c) and average of absolute position deviation in every angular velocity and acceleration condition averaged over several attempts to reach the position imposed by a step function (d) Data and code for this characterization are available here","title":"Characterization"},{"location":"characterization/characterization/#minimum-incremental-motion-mim-and-backlash","text":"The Minimum incremental motion reliably measured corresponds to 0.1 degrees. The backlash observed in the worst case scenario corresponding to the offset created on the change in direction of the MIM test has been 0.04 degrees. Figure 2. Minimum incremental motion Data and code for this characterization are available here","title":"Minimum incremental motion (MIM) and backlash"},{"location":"characterization/characterization/#accuracy-and-repeatability","text":"In order to evaluate the accuracy and repeatability of the rotary stage, a sequence of increments of 45 degrees in both rotation directions has been performed, collecting 8 position deviations in each direction (16 per each velocity/acceleration condition). The overall accuracy and repeatability have been calculated from all conditions according to the following equations (https://www.newport.com/n/motion-basics-terminology-and-standards). Accuracy: Repeatability: Figure 3. Accuracy and repeatability test sequence (a) and average of absolute position deviation in every angular velocity and acceleration condition (b)","title":"Accuracy and repeatability"},{"location":"characterization/characterization/#closed-loop-characterization","text":"For the closed loop algorithm, the stability of the system response has been evaluated by the analysis of the step response for all previously described conditions (20-100 \u00b0\u00b7s\u00af\u00b9 and 200-1200 \u00b0\u00b7s\u00af\u00b2). From that a contour plot has been extracted to be used as a map to avoid regions of inaccuracy and instability. Sometimes event achieving a small error the stage can overshoot as shown in figure 4b. On figures 4c and 4d are shown the regions to avoid errors and instabilities around the set point. Figure 4. Step functions at 20 \u00b0\u00b7s\u00af\u00b9 /200 \u00b0\u00b7s\u00af\u00b2 and 100 \u00b0\u00b7s\u00af\u00b9 /1200 \u00b0\u00b7s\u00af\u00b2 (Figures a and b respectively). Accuracy and repeatability test sequence (c) and average of absolute position deviation in every angular velocity and acceleration condition averaged over several attempts to reach the position imposed by a step function (d) Data and code for this characterization are available here","title":"Closed-loop characterization"},{"location":"characterization/requirements/","text":"Required libraries and software packages Software packages Arduino IDE: https://www.arduino.cc/en/software Teensyduino: https://www.pjrc.com/teensy/teensyduino.html Libraries Basic Optical sensors ADNS 2160: https://github.com/zapmaker/OptiMouse Stepper motor control: https://luni64.github.io/TeensyStep/ Encoder: https://github.com/PaulStoffregen/Encoder Futures implementations These are Optical motion sensor options with higher capabilities than the ADNS 2160. All of them use the SPI bus. - Optical sensors ADNS 3500: https://github.com/Tom101222/Adns-3050-Optical-Sensor - Optical sensors PWM3360: https://github.com/mrjohnk/PMW3360DM-T2QU - Optical sensors ADNS 9800: https://github.com/mrjohnk/ADNS-9800 Basic Arduino code description The different Arduino sketches are available on: https://github.com/atranvan/vestibular_setup/tree/Files/Arduino%20code Closed_loop.ino The closed loop code uses the measured angle increment as a setpoint for the proportional control. The animal can control the rotation of the platform. Open_loop.ino The Open loop example uses two variables introduced by the user (eg. 0-360 degres) as a setpoints to switch every certain interval and therefore to swing from one to the other. Open_loop_SD.ino This example is like the open loop example but saving the different variables on the SD card on the Teensy 3.5 SD card slot. That program was used to record accuracy and repeatability data of the stage. Open_loop_moveAsync.ino This example is like the Open_loop_SD.ino but instead of using the proportional control it only bases its rotation movement on the teensystep method moveAsync() which is a non-blocking trapezoidal profile movement.","title":"Requirements"},{"location":"characterization/requirements/#required-libraries-and-software-packages","text":"","title":"Required libraries and software packages"},{"location":"characterization/requirements/#software-packages","text":"Arduino IDE: https://www.arduino.cc/en/software Teensyduino: https://www.pjrc.com/teensy/teensyduino.html","title":"Software packages"},{"location":"characterization/requirements/#libraries","text":"","title":"Libraries"},{"location":"characterization/requirements/#basic","text":"Optical sensors ADNS 2160: https://github.com/zapmaker/OptiMouse Stepper motor control: https://luni64.github.io/TeensyStep/ Encoder: https://github.com/PaulStoffregen/Encoder","title":"Basic"},{"location":"characterization/requirements/#futures-implementations","text":"These are Optical motion sensor options with higher capabilities than the ADNS 2160. All of them use the SPI bus. - Optical sensors ADNS 3500: https://github.com/Tom101222/Adns-3050-Optical-Sensor - Optical sensors PWM3360: https://github.com/mrjohnk/PMW3360DM-T2QU - Optical sensors ADNS 9800: https://github.com/mrjohnk/ADNS-9800","title":"Futures implementations"},{"location":"characterization/requirements/#basic-arduino-code-description","text":"The different Arduino sketches are available on: https://github.com/atranvan/vestibular_setup/tree/Files/Arduino%20code","title":"Basic Arduino code description"},{"location":"characterization/requirements/#closed_loopino","text":"The closed loop code uses the measured angle increment as a setpoint for the proportional control. The animal can control the rotation of the platform.","title":"Closed_loop.ino"},{"location":"characterization/requirements/#open_loopino","text":"The Open loop example uses two variables introduced by the user (eg. 0-360 degres) as a setpoints to switch every certain interval and therefore to swing from one to the other.","title":"Open_loop.ino"},{"location":"characterization/requirements/#open_loop_sdino","text":"This example is like the open loop example but saving the different variables on the SD card on the Teensy 3.5 SD card slot. That program was used to record accuracy and repeatability data of the stage.","title":"Open_loop_SD.ino"},{"location":"characterization/requirements/#open_loop_moveasyncino","text":"This example is like the Open_loop_SD.ino but instead of using the proportional control it only bases its rotation movement on the teensystep method moveAsync() which is a non-blocking trapezoidal profile movement.","title":"Open_loop_moveAsync.ino"},{"location":"characterization/specification/","text":"Specifications of the rotary stage Resolution stepper motor (\u00b0) 0.0024 Resolution Encoder (\u00b0) 0.024 Accuracy (\u00b0) 0.37 Repeatability (\u00b0) 0.1 Minimum incremental motion (\u00b0) 0.1 Maximum angular velocity (\u00b0\u00b7s\u00af\u00b9) 100 Maximum angular acceleration (\u00b0\u00b7s\u00af\u00b2) 1200 Backlash (\u00b0) 0.04","title":"Specification"},{"location":"characterization/specification/#specifications-of-the-rotary-stage","text":"Resolution stepper motor (\u00b0) 0.0024 Resolution Encoder (\u00b0) 0.024 Accuracy (\u00b0) 0.37 Repeatability (\u00b0) 0.1 Minimum incremental motion (\u00b0) 0.1 Maximum angular velocity (\u00b0\u00b7s\u00af\u00b9) 100 Maximum angular acceleration (\u00b0\u00b7s\u00af\u00b2) 1200 Backlash (\u00b0) 0.04","title":"Specifications of the rotary stage"},{"location":"holders/assembly/","text":"Assembly From the initial design for behavioural recordings or imaging, we designed an additional head holder plate (Head plate) which is mechanically connected with three M3 screws to a Left handed micromanipulator MM33. This device provides fine adjustment (0.10 mm) of the three axes with a finer micrometer adjustment for the vertical stage, ideal to precisely adjust the depth of an extracellular probe. The total range of motion is 10 mm for the x axis and 20 mm for the Y and Z axes. Figure 1 and 2. Head holding system assembly The parts have been successfully 3D printed using FormLabs Clear V4 resin. The resulting stiffness has been proved appropriate for the integrity of electrophysiology experiments. Figure 3. Head-plate system subassembly Figure 4. Head-plate system nuts insertion The Head holder is assembled on the Ring with M6 screws, also 3D printed in clear V4 resin in a Form 2 3D printer. The Ring is assembled with two RS6P_M posts on the rotary stage platform. Figure 5. Head holding system and circular platform assembly Figure 6. Assembly on platform Figure 7. Assembly on platform","title":"Assembly"},{"location":"holders/assembly/#assembly","text":"From the initial design for behavioural recordings or imaging, we designed an additional head holder plate (Head plate) which is mechanically connected with three M3 screws to a Left handed micromanipulator MM33. This device provides fine adjustment (0.10 mm) of the three axes with a finer micrometer adjustment for the vertical stage, ideal to precisely adjust the depth of an extracellular probe. The total range of motion is 10 mm for the x axis and 20 mm for the Y and Z axes. Figure 1 and 2. Head holding system assembly The parts have been successfully 3D printed using FormLabs Clear V4 resin. The resulting stiffness has been proved appropriate for the integrity of electrophysiology experiments. Figure 3. Head-plate system subassembly Figure 4. Head-plate system nuts insertion The Head holder is assembled on the Ring with M6 screws, also 3D printed in clear V4 resin in a Form 2 3D printer. The Ring is assembled with two RS6P_M posts on the rotary stage platform. Figure 5. Head holding system and circular platform assembly Figure 6. Assembly on platform Figure 7. Assembly on platform","title":"Assembly"},{"location":"holders/components/","text":"Experiments The head holding system has been designed to be used in imaging and electrophysiology experiments. The observation of neurons through the implanted cranial window on the head of the rodent during rotation requires an independent system to align the axis of the motor rotation with the microscope field of view. :--: Figure 1. Displacement of the cells due to the animal\u2019s head rotation For these reasons a head fixation post with three degrees of freedom was designed to get to center the animal's head and to adjust the height depending on the animal\u2019s height. Figure 2. Readjustment of this center of rotation This head holding system is based on the assembly of 3 Thorlabs\u00ae translational stage MT1\\M to get the three translational movements with reliability. The main goals of this design are: Adjust the height from mouse to mouse, Adjust the center of the microscope field of view or the recording probe with the center of rotation Reliability and repeatability experiment after experiment. Also the MT405 side mounted actuator adapter. The resolution of the system is 10 microns, and the range of each micrometer is 13 mm. Figure 3. Virtual assembly of the head post designed using Solidworks\u00ae software (left) and real assembly (right). The materials needed for the assembly are: the 2 3D printable parts, the three MT1\\M translational stages, three MT405 side mounted actuator adapter, two M2.5 Nuts, two hexagonal M2.5 screws, fifteen M6 screws (two of them optional) and two Bollhoff M6 threaded inserts (also optional). Figure 4. Drawings of the link 1:2 scale The 3D printed parts have been printed using a Form2 SLS 3D printer from Formlabs\u00ae using the standard features with Clear V4 resin type.## Bill of materials Figure 5. Thorlabs\u00ae components needed: MT1\\M translational stage (left) and MT405 side mounted actuator adapter (right) Optic fiber holder for optogenetics For optogenetic stimulation, the optic fiber can be secured to the micro-manipulator using the Thorlabs FCM13/M and a custom 3d printed adaptor. This allows the positioning of the light source at any desired location in the cranial window area. Figure 6. Optical fiber holder Bill of materials Component Manufacturer Units Reference Link Link MT1/M 3D printed part 1 STP file , STL files Head plate 3D printed part 1 STP file , STL file Neuronexus holder 3D printed part 1 STP file Optic fiber holder 3D printed part 1 STP file , STL file MT1/M translational stage Thorlabs 3 MT1/M MT405 side mounted actuator adapter Thorlabs 3 MT405 M6 hex bold screws 16mm length RS components 15 (2 optional) 281-144 M2.5 hex bold screws RS components 4 483-8124 M2.5 nuts RS components 2 560-287 M6 threaded inserts RS components 2 (optional) 664-7359 M4 screws 3 M3 screws 2 Left handed micromanipulator MM33 Sutter 1 MM33 The scales for all axes are calibrated in 0.10mm increments and the fine micrometer adjustment for the X-axis thrust is calibrated at 0.01mm with estimates to 5\u03bcm. X-axis coarse movement: 37 mm X-axis fine movement: 10 mm Y-axis horizontal movement: 20 mm Z-axis vertical movement: 20 mm","title":"Components"},{"location":"holders/components/#experiments","text":"The head holding system has been designed to be used in imaging and electrophysiology experiments. The observation of neurons through the implanted cranial window on the head of the rodent during rotation requires an independent system to align the axis of the motor rotation with the microscope field of view. :--: Figure 1. Displacement of the cells due to the animal\u2019s head rotation For these reasons a head fixation post with three degrees of freedom was designed to get to center the animal's head and to adjust the height depending on the animal\u2019s height. Figure 2. Readjustment of this center of rotation This head holding system is based on the assembly of 3 Thorlabs\u00ae translational stage MT1\\M to get the three translational movements with reliability. The main goals of this design are: Adjust the height from mouse to mouse, Adjust the center of the microscope field of view or the recording probe with the center of rotation Reliability and repeatability experiment after experiment. Also the MT405 side mounted actuator adapter. The resolution of the system is 10 microns, and the range of each micrometer is 13 mm. Figure 3. Virtual assembly of the head post designed using Solidworks\u00ae software (left) and real assembly (right). The materials needed for the assembly are: the 2 3D printable parts, the three MT1\\M translational stages, three MT405 side mounted actuator adapter, two M2.5 Nuts, two hexagonal M2.5 screws, fifteen M6 screws (two of them optional) and two Bollhoff M6 threaded inserts (also optional). Figure 4. Drawings of the link 1:2 scale The 3D printed parts have been printed using a Form2 SLS 3D printer from Formlabs\u00ae using the standard features with Clear V4 resin type.## Bill of materials Figure 5. Thorlabs\u00ae components needed: MT1\\M translational stage (left) and MT405 side mounted actuator adapter (right)","title":"Experiments"},{"location":"holders/components/#optic-fiber-holder-for-optogenetics","text":"For optogenetic stimulation, the optic fiber can be secured to the micro-manipulator using the Thorlabs FCM13/M and a custom 3d printed adaptor. This allows the positioning of the light source at any desired location in the cranial window area. Figure 6. Optical fiber holder","title":"Optic fiber holder for optogenetics"},{"location":"holders/components/#bill-of-materials","text":"Component Manufacturer Units Reference Link Link MT1/M 3D printed part 1 STP file , STL files Head plate 3D printed part 1 STP file , STL file Neuronexus holder 3D printed part 1 STP file Optic fiber holder 3D printed part 1 STP file , STL file MT1/M translational stage Thorlabs 3 MT1/M MT405 side mounted actuator adapter Thorlabs 3 MT405 M6 hex bold screws 16mm length RS components 15 (2 optional) 281-144 M2.5 hex bold screws RS components 4 483-8124 M2.5 nuts RS components 2 560-287 M6 threaded inserts RS components 2 (optional) 664-7359 M4 screws 3 M3 screws 2 Left handed micromanipulator MM33 Sutter 1 MM33 The scales for all axes are calibrated in 0.10mm increments and the fine micrometer adjustment for the X-axis thrust is calibrated at 0.01mm with estimates to 5\u03bcm. X-axis coarse movement: 37 mm X-axis fine movement: 10 mm Y-axis horizontal movement: 20 mm Z-axis vertical movement: 20 mm","title":"Bill of materials"},{"location":"holders/headclamp/","text":"Head-fixation clamp This is the design of the clamp used for chronic implants for experimentation with the previously described head holding device. Figure 1. Head clamp drawings The following study aims to compare headclamp performance depending on the material used (Aluminum, Titanium or Steel) and thickness (0.8 mm - 1 mm). This comparison can be performed knowing that the materials will be manufactured using the CNC technique from a block of homogeneous and isotropic material. The three materials simulated on the Solidworks simulation tool are: Aluminum 6061-T6 1 mm of thickness (0.3g). Titanium Grade 2 0.8 mm of thickness (0.41g). Stainless steel 316 0.8 mm of thickness (0.73g). The Initial conditions for the simulation are: A static load applied to the center ring (Blue arrows). Three axis fixture on the parts where the metric 2.5 screws are placed (green arrows). Figure 2. Head clamp simulations The results of maximum displacements obtained for each condition Aluminum max. displacement = 9.445e-04 mm Titanium max. displacement = 11.79e-04 mm Stainless Steel max. displacement = 6.443e-04 mm In conclusion, with the stainless steel head plate of 0.8 mm thickness, the displacement and strain of the head clamp is less than the Aluminum one (1 mm). Otherwise with the Titanium we lose stiffness with 0.8 mm thickness. Finally, the manufacturing supplier was 3D hubs and the chosen material: CNC machining / Stainless steel 316L / Smoothed (Ra 1.6\u03bcm, 63\u03bcin) The manufacturing files are available here and here .","title":"Headclamp"},{"location":"holders/headclamp/#head-fixation-clamp","text":"This is the design of the clamp used for chronic implants for experimentation with the previously described head holding device. Figure 1. Head clamp drawings The following study aims to compare headclamp performance depending on the material used (Aluminum, Titanium or Steel) and thickness (0.8 mm - 1 mm). This comparison can be performed knowing that the materials will be manufactured using the CNC technique from a block of homogeneous and isotropic material. The three materials simulated on the Solidworks simulation tool are: Aluminum 6061-T6 1 mm of thickness (0.3g). Titanium Grade 2 0.8 mm of thickness (0.41g). Stainless steel 316 0.8 mm of thickness (0.73g). The Initial conditions for the simulation are: A static load applied to the center ring (Blue arrows). Three axis fixture on the parts where the metric 2.5 screws are placed (green arrows). Figure 2. Head clamp simulations The results of maximum displacements obtained for each condition Aluminum max. displacement = 9.445e-04 mm Titanium max. displacement = 11.79e-04 mm Stainless Steel max. displacement = 6.443e-04 mm In conclusion, with the stainless steel head plate of 0.8 mm thickness, the displacement and strain of the head clamp is less than the Aluminum one (1 mm). Otherwise with the Titanium we lose stiffness with 0.8 mm thickness. Finally, the manufacturing supplier was 3D hubs and the chosen material: CNC machining / Stainless steel 316L / Smoothed (Ra 1.6\u03bcm, 63\u03bcin) The manufacturing files are available here and here .","title":"Head-fixation clamp"},{"location":"platform/assembly/","text":"Assembly instructions Start assembling the Acrylic laser cut part \u201cBase\u201d with the Thorlabs RS05P Pedestal posts using M6 screws. That posts are used to attach the rotary stage to the experimental table where the experiments are taking place. Figure 1. Base assembly Insert two M6 screws with their nuts in order to attach the tube guide where the horizontal tube goes through and connects with the elbow. Attach with M6 screws the two Thorlabs posts PH_50 and the TR_50 to the base. Figure 2. Rotary joint telescopic posts assembly The two Thorlabs PH_50 with the TR_50 are used to hold the rotary joint. In order to attach the rotary joint, you only need two M6 or two M4 with washers depending on the position of the TR_50 (in one side is M4 in the other is M6). The tubing can be installed now or at the end of the assembly. Figure 3.Rotary joint assembly Attach the seven Thorlabs RS150 posts to the base using M6 screws. Figure 4. Thorlabs RS150 assembly | | |:--:| | Base Assembly | Once you have the rotary joint spacer 3D printed, insert M3 brass threaded inserts and then cure the part with UV light. Figure 5. Rotary joint spacer threaded inserts The Rotary Joint spacer is assembled with the rotary joint using 25 mm length M3 grab screws. These are inserted using the radial holes on the bottom of the part. Figure 6. Rotary joint spacer assembly Figure 7. Rotary joint assembly The crossed roller bearing BRS RU124X must be assembled with the Platform 2 using ten M5 bolts and M5 nuts. Figure 8. Crossed roller bearing assembled with the Platform 2 The manufacturer recommends the following installation method: | | |:--:| | Figure 9. Crossed roller bearing installation method (left) and Cross roller bearing installed (right) | Warning On the laser cut part \u201cPlatform 2\u201d it is recommended to make the chamfers for the M4 countersink screws that will hold the motor. This step is important because the head of the screws have to be at the same level as the surface of the Platform 2, otherwise they might touch the pulley or the belt. Figure 10. Detail of the countersink screws level with the surface Insert the four M4 screws with their nuts to hold the Nema 23 stepper motor with the motor spacer. Figure 11. Motor assembly The big pulley can be laser cut as shown in Figure 12. It is composed by six layers of acrylic (2 x layer 1 in 5 mm thickness, 1 x layer 2 in 5 mm thickness, 2 x layer 2 in 3 mm thickness and 1 x layer 3 in 3 mm thickness). The threaded inserts are attached like in the previous version. In this case we recommend to heat them with the soldering iron until they melt the plastic around and go through the different layers. It is recommended to insert a couple using the external thread in order to get good alignment of the pulley teeth. Alternatively, there is an STL file to 3D print the pulley in one single piece. We haven\u2019t tried that option yet. Figure 12. Big pulley assembly (left) and threaded inserts (right) After laser cutting the circular platform, glue a small 5 mm Neodymium magnet as indicated in figure 14. One of the surfaces of the magnet has to be coincident with the bottom surface of the platform. The magnet is there to interact with the Hall effect sensor at the bottom and trigger a state change to high or low to complete the homing position. It is also essential to make the chamfer on the outside holes for the countersink screws. Figure 13. Magnet gluing and chamfers Insert eight M6 screws to attach the Circular platform with the big pulley using the threaded inserts thread. Figure 14. Circular platform and big pulley assembly Assemble the Base with the Platform 2 using 7 M6 screws. Figure 15. Base and Platform 2 assembly Platform assembly Assemble the Hall Effect sensor used for the homing sequence, using two M3 screws, two Hall effect spacers and the Hall Effect holder. Figure 16. Hall Effect sensor assembly Figure 17. Hall effect sensor placement In order to assemble the circular platform, place the spacer in contact with the inner ring of the bearing, then place the circular platform previously assembled with the big pulley on the spacer and use the M5 screws also installed as in the first step of the bearing. After that you can use the Thorlabs PH_50 and the TR_50 to adjust the height of the rotary joint spacer until this one makes contact with the circular platform surface. Once it makes contact you can insert six M4 screws to secure it. Figure 18. Circular platform assembly Figure 19. Adjustment of the Rotary joint height The shaft of the Motor is 8 mm in diameter and the inner diameter of the small pulley (https://uk.rs-online.com/web/p/belt-pulleys/1465412/) is 6 mm. The inner diameter of the pulley has to be increased to 8 mm with a vertical drilling machine/milling machine (Figure 20). Add a second hole with 3.3 mm diameter (using a 3.3 mm drill bit) to add the screw that prevents the pulley to rotate around the motor shaft. Thread the hole using an M4 tap toolkit. For that step, the use of a vice is recommended to hold the pulley while drilling. In order to connect the encoder shaft with the pulley, the encoder attachment must be 3D printed and two extra 2.5 mm holes must be drilled at the top of the pulley. Then, an M3 thread must be made using the M3 tap tool. Figure 20. Small pulley The pulley can be assembled before or after attaching the motor with the platform 2. Figure 21. Metal small pulley modified The belt has to be enveloping the small pulley when you insert it on the motor shaft. You will feel a \u201cHigh\u201d tension when pulling the belt since it is rigid. !!! warning: Remember to put the flat part of the motor shaft oriented in a comfortable position to make pressure with the pulley M4 screw afterwards. Figure 22. Small pulley with motor shaft assembly The big pulley is attached with the Circular platform with M6 screws and then attached with the crossed roller bearing using M5 screws. Figure 23. Assembly of the big pulley with the platform and both with the crossed roller bearing using M5 screws Three M3 screws are used to attach the Encoder holder with the encoder. Figure 24. Encoder holder and encoder assembly Once the belt cover part is cut with the laser, four brass M4 threaded inserts must be inserted on the holes, heating them with the soldering iron or just by applying pressure. Figure 25. M4 threaded inserts on the belt cover Now four M4 screws can be inserted from the top placing the spacers coincident with the holes. Figure 26. M4 threaded inserts on the belt cover The belt cover can now be installed using M6 screws, nuts and the cover spacers. After that, the encoder shaft needs to be put in contact with the M4 grub screw at the top of the pulley. Figure 27. Belt cover assembly Small pulley assembly Two ball bearings are inserted on the belt tensor and one M6 screw is used to install the belt tensor in the guide. Use four washers to get a good fit on the inside and outside of the screw with the two sides of belt cover and Platform 2. Figure 28. Belt tensor assembly Figure 29. Detail of the two ball bearings Now adjust the tension of the belt. After that check that the belt is not touching the bottom or the top surfaces. Figure 30. Space on both sides of the belt The sphere holder has to be attached with four M6 screws. Figure 31-32. Sphere holder assembly All the components that go on the circular platform : Head fixation post, Pupil tracking camera, Reward delivery system and optical sensor holders, can be assembled as with the Stenmeyer DT240 version. Figure 37. Complete assembly","title":"Assembly"},{"location":"platform/assembly/#assembly-instructions","text":"Start assembling the Acrylic laser cut part \u201cBase\u201d with the Thorlabs RS05P Pedestal posts using M6 screws. That posts are used to attach the rotary stage to the experimental table where the experiments are taking place. Figure 1. Base assembly Insert two M6 screws with their nuts in order to attach the tube guide where the horizontal tube goes through and connects with the elbow. Attach with M6 screws the two Thorlabs posts PH_50 and the TR_50 to the base. Figure 2. Rotary joint telescopic posts assembly The two Thorlabs PH_50 with the TR_50 are used to hold the rotary joint. In order to attach the rotary joint, you only need two M6 or two M4 with washers depending on the position of the TR_50 (in one side is M4 in the other is M6). The tubing can be installed now or at the end of the assembly. Figure 3.Rotary joint assembly Attach the seven Thorlabs RS150 posts to the base using M6 screws. Figure 4. Thorlabs RS150 assembly | | |:--:| | Base Assembly | Once you have the rotary joint spacer 3D printed, insert M3 brass threaded inserts and then cure the part with UV light. Figure 5. Rotary joint spacer threaded inserts The Rotary Joint spacer is assembled with the rotary joint using 25 mm length M3 grab screws. These are inserted using the radial holes on the bottom of the part. Figure 6. Rotary joint spacer assembly Figure 7. Rotary joint assembly The crossed roller bearing BRS RU124X must be assembled with the Platform 2 using ten M5 bolts and M5 nuts. Figure 8. Crossed roller bearing assembled with the Platform 2 The manufacturer recommends the following installation method: | | |:--:| | Figure 9. Crossed roller bearing installation method (left) and Cross roller bearing installed (right) | Warning On the laser cut part \u201cPlatform 2\u201d it is recommended to make the chamfers for the M4 countersink screws that will hold the motor. This step is important because the head of the screws have to be at the same level as the surface of the Platform 2, otherwise they might touch the pulley or the belt. Figure 10. Detail of the countersink screws level with the surface Insert the four M4 screws with their nuts to hold the Nema 23 stepper motor with the motor spacer. Figure 11. Motor assembly The big pulley can be laser cut as shown in Figure 12. It is composed by six layers of acrylic (2 x layer 1 in 5 mm thickness, 1 x layer 2 in 5 mm thickness, 2 x layer 2 in 3 mm thickness and 1 x layer 3 in 3 mm thickness). The threaded inserts are attached like in the previous version. In this case we recommend to heat them with the soldering iron until they melt the plastic around and go through the different layers. It is recommended to insert a couple using the external thread in order to get good alignment of the pulley teeth. Alternatively, there is an STL file to 3D print the pulley in one single piece. We haven\u2019t tried that option yet. Figure 12. Big pulley assembly (left) and threaded inserts (right) After laser cutting the circular platform, glue a small 5 mm Neodymium magnet as indicated in figure 14. One of the surfaces of the magnet has to be coincident with the bottom surface of the platform. The magnet is there to interact with the Hall effect sensor at the bottom and trigger a state change to high or low to complete the homing position. It is also essential to make the chamfer on the outside holes for the countersink screws. Figure 13. Magnet gluing and chamfers Insert eight M6 screws to attach the Circular platform with the big pulley using the threaded inserts thread. Figure 14. Circular platform and big pulley assembly Assemble the Base with the Platform 2 using 7 M6 screws. Figure 15. Base and Platform 2 assembly Platform assembly Assemble the Hall Effect sensor used for the homing sequence, using two M3 screws, two Hall effect spacers and the Hall Effect holder. Figure 16. Hall Effect sensor assembly Figure 17. Hall effect sensor placement In order to assemble the circular platform, place the spacer in contact with the inner ring of the bearing, then place the circular platform previously assembled with the big pulley on the spacer and use the M5 screws also installed as in the first step of the bearing. After that you can use the Thorlabs PH_50 and the TR_50 to adjust the height of the rotary joint spacer until this one makes contact with the circular platform surface. Once it makes contact you can insert six M4 screws to secure it. Figure 18. Circular platform assembly Figure 19. Adjustment of the Rotary joint height The shaft of the Motor is 8 mm in diameter and the inner diameter of the small pulley (https://uk.rs-online.com/web/p/belt-pulleys/1465412/) is 6 mm. The inner diameter of the pulley has to be increased to 8 mm with a vertical drilling machine/milling machine (Figure 20). Add a second hole with 3.3 mm diameter (using a 3.3 mm drill bit) to add the screw that prevents the pulley to rotate around the motor shaft. Thread the hole using an M4 tap toolkit. For that step, the use of a vice is recommended to hold the pulley while drilling. In order to connect the encoder shaft with the pulley, the encoder attachment must be 3D printed and two extra 2.5 mm holes must be drilled at the top of the pulley. Then, an M3 thread must be made using the M3 tap tool. Figure 20. Small pulley The pulley can be assembled before or after attaching the motor with the platform 2. Figure 21. Metal small pulley modified The belt has to be enveloping the small pulley when you insert it on the motor shaft. You will feel a \u201cHigh\u201d tension when pulling the belt since it is rigid. !!! warning: Remember to put the flat part of the motor shaft oriented in a comfortable position to make pressure with the pulley M4 screw afterwards. Figure 22. Small pulley with motor shaft assembly The big pulley is attached with the Circular platform with M6 screws and then attached with the crossed roller bearing using M5 screws. Figure 23. Assembly of the big pulley with the platform and both with the crossed roller bearing using M5 screws Three M3 screws are used to attach the Encoder holder with the encoder. Figure 24. Encoder holder and encoder assembly Once the belt cover part is cut with the laser, four brass M4 threaded inserts must be inserted on the holes, heating them with the soldering iron or just by applying pressure. Figure 25. M4 threaded inserts on the belt cover Now four M4 screws can be inserted from the top placing the spacers coincident with the holes. Figure 26. M4 threaded inserts on the belt cover The belt cover can now be installed using M6 screws, nuts and the cover spacers. After that, the encoder shaft needs to be put in contact with the M4 grub screw at the top of the pulley. Figure 27. Belt cover assembly Small pulley assembly Two ball bearings are inserted on the belt tensor and one M6 screw is used to install the belt tensor in the guide. Use four washers to get a good fit on the inside and outside of the screw with the two sides of belt cover and Platform 2. Figure 28. Belt tensor assembly Figure 29. Detail of the two ball bearings Now adjust the tension of the belt. After that check that the belt is not touching the bottom or the top surfaces. Figure 30. Space on both sides of the belt The sphere holder has to be attached with four M6 screws. Figure 31-32. Sphere holder assembly All the components that go on the circular platform : Head fixation post, Pupil tracking camera, Reward delivery system and optical sensor holders, can be assembled as with the Stenmeyer DT240 version. Figure 37. Complete assembly","title":"Assembly instructions"},{"location":"platform/components/","text":"Main components Rotary joint The rotary joint enables electrical communications between the base and the rotating platform. It has a through-hole design for routing the compressed air tube. The selected model is the Senring UH1256-02-0610-06S, of the UH1256-02 Series [1] . It has two USB ports that can be used to connect e.g. cameras, and several power and data wires to connect different sensors and other accessories. Figure 1. Senring UH1256-02-0610-06S Series Crossed roller bearing The crossed roller bearing iprovides a strong joint between the static base and the rotation platform. A suitable model for the application is the BRS RU124X considering fitting the rotary joint (inner diameter > 55mm). The bearing provides stong joint stability against axial and radial forces and torque, due to its best-in class axial runout (2-5 \u00b5m). Figure 2. SBRS RU124X Crossed roller bearing DC motor and driver In order to get an approximation of the motor requirements we have estimated the moment of inertia around the vertical axis. For this approximation we have considered two main components: the circular platform and all the elements that are on the platform, and the inner ring of the crossed roller bearing. To simplify the approximation, the internal ring of the bearing has been considered as a stainless steel solid part. The negligible friction force of the bearing has not been taken into account. Both moments of inertia have been extracted using the mass properties of the Solidworks\u00ae CAD software. With this value we can make the approximation of the torque needed to accelerate the system using the Newton\u2019s 2nd law of rotation : . After numerical simulation, we obtain a theoretical maximum acceleration, useful to choose the motor, described by the function : With this relationship we can estimate the maximum torque needed for the motor and the theoretical maximum angular acceleration is 1100 \u00b0/s^2 with the 3 Nm motor option. A stepper motor was selected accordingly: Nema 23 Stepper Motor 3 Nm 4.2A with a DM542A driver. Figure 3. Nema 23 stepper motor and DM542A stepper driver Nema 23 Stepper motor main features: Property value steps/rev 200 L (mH) 3.2 I max (A) 4.2 V (V) 24 T (N.m) 3 P max (W) 96 The current can be selected using the first four switches of the driver DIP switch: The driver has a DIP switch to select the desired micro stepping mode: Belt selection We have adjusted the number of teeth of the big and the small pulley in order to get a gear ratio of 4:1 considering the minimum diameter of the big pulley as the outside diameter of the crossed roller bearing BRS RU124X. The diameter of the commercial small pulley with = 36 teeth is 34.38. Once the big and small pulley diameters ( D and d ) have been defined, the distance between centers ( C ) is alculated to get the desired commercial length L : The number of teeth obtained for the big pulley is 216, and the distance between centers 216 mm. That result determined the choice of the belt for our device. The timing belt The size of the belt was calculated considering the outside diameter of the Crossed roller bearing (OD > 165 mm) and the desired gear ratio of 4 which provides the stage of a maximum theoretical value of 12 Nm. In order to calculate the belt parameters, first we consider the maximum width of the belt for our space constraints, which is 20 mm maximum. According with the distance between centers and the pulley diameters, the length of belt needed is 927 mm and the chosen belt width is 15 mm. Figure 6. Timing belt The small pulley The pulley that is driven by the Nema 23 stepper motor is a 36 teeth HTD3 metal pulley provided by RS Components. Figure 7. Small pulley Bill of materials Component Quantity Supplier Reference Base 1 Laser cut part STEP file Platform 2 (Rev1) 1 - STEP file Belt cover (Rev1) 1 - STEP file Circular platform 1 - STEP file Spacer 1 - STEP file Encoder holder 1 - STEP file Small pulley (Rev1) 1 RS Components https://uk.rs-online.com/web/p/belt-pulleys/1465412/ Big pulley (Rev1) 1 - STEP file , STL file Belt 1 Ebay https://www.ebay.co.uk/itm/324243196114?hash=item4b7e6688d2:g:YU8AAOSwIW1fH-nz Encoder Atachment 1 - STEP file , STL file Belt tensor 1 3D printed STEP file Encoder spacer 4 Laser cut part/3D printed STEP file Cover spacer 6 3D printed STEP file Tube guide 1 3D printed STEP file Rotary joint spacer 1 3D printed STEP file Ball Holder 1 3D printed STL file CF175 4 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=CF175#ad-image-0 RS05P Pedestal posts 4 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=RS05P/M RS150 7 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=RS150/M TR_50M Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=TR50/M PH_50 2 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=PH50/M#ad-image-0 M6 washers 2 https://www.thorlabs.com/newgrouppage9.cfm?objectgroup_id=248 M6 screws 44 M5 screws 24 M4 screws 11 M3 screws 7 M6 nuts 9 M5 nuts 14 BRS RU124X bearing 1 BRS http://www.rigbrsbearing.com/product/ru124x-cross-roller-ring/ Rotary Joint 1 Senring https://www.senring.com/usb-conductive-slip-ring/dual-Channels/uh1256-02.html Encoder 1 Amazon https://www.amazon.co.uk/Wisamic-Incremental-Encoder-Dc5-24v-Voltage/dp/B015GYY7XU/ref=sr_1_8?dchild=1&keywords=rotary+encoder&qid=1587721002&sr=8-8 Hall efect sensor 1 Amazon https://www.amazon.co.uk/gp/product/B06XHG9CYN/ref=ppx_yo_dt_b_asin_title_o07_s00?ie=UTF8&psc=1 Magnet 1 RS Components 792-4559 Nema 23 Stepper motor 1 Ebay https://www.ebay.co.uk/itm/Free-Ship-Nema-23-Stepper-Motor-435oz-in-4-2A-Driver-Controller-DM542A/273805042516?ssPageName=STRK%3AMEBIDX%3AIT&_trksid=p2060353.m2749.l2649 Motor driver 1 M6 threadd inserts M4 threaded inserts Bearings 2 RS Components 619-0014 Incremental encoder 1 Amazon https://www.amazon.co.uk/Wisamic-Incremental-Encoder-Dc5-24v-Voltage/dp/B015GYY7XU/ref=asc_df_B015GYY7XU/?tag=googshopuk-21&linkCode=df0&hvadid=231995364607&hvpos=&hvnetw=g&hvrand=2855211729431962431&hvpone=&hvptwo=&hvqmt=&hvdev=c&hvdvcmdl=&hvlocint=&hvlocphy=9045997&hvtargid=pla-487280118197&psc=1 References [1] https://www.senring.com/usb-conductive-slip-ring/dual-Channels/uh1256-02.html","title":"Components"},{"location":"platform/components/#main-components","text":"","title":"Main components"},{"location":"platform/components/#rotary-joint","text":"The rotary joint enables electrical communications between the base and the rotating platform. It has a through-hole design for routing the compressed air tube. The selected model is the Senring UH1256-02-0610-06S, of the UH1256-02 Series [1] . It has two USB ports that can be used to connect e.g. cameras, and several power and data wires to connect different sensors and other accessories. Figure 1. Senring UH1256-02-0610-06S Series","title":"Rotary joint"},{"location":"platform/components/#crossed-roller-bearing","text":"The crossed roller bearing iprovides a strong joint between the static base and the rotation platform. A suitable model for the application is the BRS RU124X considering fitting the rotary joint (inner diameter > 55mm). The bearing provides stong joint stability against axial and radial forces and torque, due to its best-in class axial runout (2-5 \u00b5m). Figure 2. SBRS RU124X Crossed roller bearing","title":"Crossed roller bearing"},{"location":"platform/components/#dc-motor-and-driver","text":"In order to get an approximation of the motor requirements we have estimated the moment of inertia around the vertical axis. For this approximation we have considered two main components: the circular platform and all the elements that are on the platform, and the inner ring of the crossed roller bearing. To simplify the approximation, the internal ring of the bearing has been considered as a stainless steel solid part. The negligible friction force of the bearing has not been taken into account. Both moments of inertia have been extracted using the mass properties of the Solidworks\u00ae CAD software. With this value we can make the approximation of the torque needed to accelerate the system using the Newton\u2019s 2nd law of rotation : . After numerical simulation, we obtain a theoretical maximum acceleration, useful to choose the motor, described by the function : With this relationship we can estimate the maximum torque needed for the motor and the theoretical maximum angular acceleration is 1100 \u00b0/s^2 with the 3 Nm motor option. A stepper motor was selected accordingly: Nema 23 Stepper Motor 3 Nm 4.2A with a DM542A driver. Figure 3. Nema 23 stepper motor and DM542A stepper driver Nema 23 Stepper motor main features: Property value steps/rev 200 L (mH) 3.2 I max (A) 4.2 V (V) 24 T (N.m) 3 P max (W) 96 The current can be selected using the first four switches of the driver DIP switch: The driver has a DIP switch to select the desired micro stepping mode:","title":"DC motor and driver"},{"location":"platform/components/#belt-selection","text":"We have adjusted the number of teeth of the big and the small pulley in order to get a gear ratio of 4:1 considering the minimum diameter of the big pulley as the outside diameter of the crossed roller bearing BRS RU124X. The diameter of the commercial small pulley with = 36 teeth is 34.38. Once the big and small pulley diameters ( D and d ) have been defined, the distance between centers ( C ) is alculated to get the desired commercial length L : The number of teeth obtained for the big pulley is 216, and the distance between centers 216 mm. That result determined the choice of the belt for our device.","title":"Belt selection"},{"location":"platform/components/#the-timing-belt","text":"The size of the belt was calculated considering the outside diameter of the Crossed roller bearing (OD > 165 mm) and the desired gear ratio of 4 which provides the stage of a maximum theoretical value of 12 Nm. In order to calculate the belt parameters, first we consider the maximum width of the belt for our space constraints, which is 20 mm maximum. According with the distance between centers and the pulley diameters, the length of belt needed is 927 mm and the chosen belt width is 15 mm. Figure 6. Timing belt","title":"The timing belt"},{"location":"platform/components/#the-small-pulley","text":"The pulley that is driven by the Nema 23 stepper motor is a 36 teeth HTD3 metal pulley provided by RS Components. Figure 7. Small pulley","title":"The small pulley"},{"location":"platform/components/#bill-of-materials","text":"Component Quantity Supplier Reference Base 1 Laser cut part STEP file Platform 2 (Rev1) 1 - STEP file Belt cover (Rev1) 1 - STEP file Circular platform 1 - STEP file Spacer 1 - STEP file Encoder holder 1 - STEP file Small pulley (Rev1) 1 RS Components https://uk.rs-online.com/web/p/belt-pulleys/1465412/ Big pulley (Rev1) 1 - STEP file , STL file Belt 1 Ebay https://www.ebay.co.uk/itm/324243196114?hash=item4b7e6688d2:g:YU8AAOSwIW1fH-nz Encoder Atachment 1 - STEP file , STL file Belt tensor 1 3D printed STEP file Encoder spacer 4 Laser cut part/3D printed STEP file Cover spacer 6 3D printed STEP file Tube guide 1 3D printed STEP file Rotary joint spacer 1 3D printed STEP file Ball Holder 1 3D printed STL file CF175 4 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=CF175#ad-image-0 RS05P Pedestal posts 4 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=RS05P/M RS150 7 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=RS150/M TR_50M Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=TR50/M PH_50 2 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=PH50/M#ad-image-0 M6 washers 2 https://www.thorlabs.com/newgrouppage9.cfm?objectgroup_id=248 M6 screws 44 M5 screws 24 M4 screws 11 M3 screws 7 M6 nuts 9 M5 nuts 14 BRS RU124X bearing 1 BRS http://www.rigbrsbearing.com/product/ru124x-cross-roller-ring/ Rotary Joint 1 Senring https://www.senring.com/usb-conductive-slip-ring/dual-Channels/uh1256-02.html Encoder 1 Amazon https://www.amazon.co.uk/Wisamic-Incremental-Encoder-Dc5-24v-Voltage/dp/B015GYY7XU/ref=sr_1_8?dchild=1&keywords=rotary+encoder&qid=1587721002&sr=8-8 Hall efect sensor 1 Amazon https://www.amazon.co.uk/gp/product/B06XHG9CYN/ref=ppx_yo_dt_b_asin_title_o07_s00?ie=UTF8&psc=1 Magnet 1 RS Components 792-4559 Nema 23 Stepper motor 1 Ebay https://www.ebay.co.uk/itm/Free-Ship-Nema-23-Stepper-Motor-435oz-in-4-2A-Driver-Controller-DM542A/273805042516?ssPageName=STRK%3AMEBIDX%3AIT&_trksid=p2060353.m2749.l2649 Motor driver 1 M6 threadd inserts M4 threaded inserts Bearings 2 RS Components 619-0014 Incremental encoder 1 Amazon https://www.amazon.co.uk/Wisamic-Incremental-Encoder-Dc5-24v-Voltage/dp/B015GYY7XU/ref=asc_df_B015GYY7XU/?tag=googshopuk-21&linkCode=df0&hvadid=231995364607&hvpos=&hvnetw=g&hvrand=2855211729431962431&hvpone=&hvptwo=&hvqmt=&hvdev=c&hvdvcmdl=&hvlocint=&hvlocphy=9045997&hvtargid=pla-487280118197&psc=1","title":"Bill of materials"},{"location":"platform/components/#references","text":"[1] https://www.senring.com/usb-conductive-slip-ring/dual-Channels/uh1256-02.html","title":"References"},{"location":"pupil/assembly/","text":"Assembly instructions Cut 2 parts of silicone tube of similar length as the mirror edges: 36 mm and 25 mm. Glue both parts with the mirror holder. Use a scalpel to meake a longitudinal cut along both glued tubes. Insert a 6 mm diameter Thorlabs post. Figure 1. Mirror holder assembly Use a 3D printing material with opaque features (e.g. FormLabs black resin). If clear resin was used, use black matt spray to paint it. Use four M2 screws and nuts to attach the camera with the camera holder part. Insert the Long Pass Filter, mounted on a CP35/M and a SM1L03 - SM1 Lens Tube in the filter holder and use four M3 screws to attach them with the filter holder cover. Use two long (25-30 mm) M3 screws as shafts to open and close the filter holder. Figure 2. Camera holder assembly Use a M6 screw and nut to attach the camera holder with the LinkMT1_camera_modification. Figure 3. Camera assembly to head-fixation system Attach the mirror holder on the setup using Thorlabs components (RA90TR/M and 12.7 mm post). Assembly the head fixation system with the left ring. Figure 4. Modifications assembled on the real setup Figure 5. Camera asembled on the platform with the rest of the components","title":"Assembly"},{"location":"pupil/assembly/#assembly-instructions","text":"Cut 2 parts of silicone tube of similar length as the mirror edges: 36 mm and 25 mm. Glue both parts with the mirror holder. Use a scalpel to meake a longitudinal cut along both glued tubes. Insert a 6 mm diameter Thorlabs post. Figure 1. Mirror holder assembly Use a 3D printing material with opaque features (e.g. FormLabs black resin). If clear resin was used, use black matt spray to paint it. Use four M2 screws and nuts to attach the camera with the camera holder part. Insert the Long Pass Filter, mounted on a CP35/M and a SM1L03 - SM1 Lens Tube in the filter holder and use four M3 screws to attach them with the filter holder cover. Use two long (25-30 mm) M3 screws as shafts to open and close the filter holder. Figure 2. Camera holder assembly Use a M6 screw and nut to attach the camera holder with the LinkMT1_camera_modification. Figure 3. Camera assembly to head-fixation system Attach the mirror holder on the setup using Thorlabs components (RA90TR/M and 12.7 mm post). Assembly the head fixation system with the left ring. Figure 4. Modifications assembled on the real setup Figure 5. Camera asembled on the platform with the rest of the components","title":"Assembly instructions"},{"location":"pupil/components/","text":"Pupil tracking camera-mirror complex Additionally, it is possible to add a camera on the head holder. The ELP webcam camera 1080P 30fps was chosen for its small footprint and light weight, and used with a Thorlabs FEL0750 - \u00d81\" Long pass Filter, Cut-Off Wavelength: 750 nm, mounted on a CP35/M - 30 mm Cage Plate with a SM1L03 - SM1 Lens Tube. The image of the animal\u2019s pupil is reflected from the FM02R - 25 mm x 36 mm Red Hot Mirror, AOI: 45\u00b0. The mirror can be adjusted with Thorlabs Posts elements and the camera can be rotated and translated for adequate positioning. Figure 1. Camera with mirror Bill of materials Component Quantity Supplier Reference Mirror holder 1 3D printed part STP file , STL file Camera holder 1 3D printed part STP file , STL file Filter holder 1 3D printed part STP file , STL file Filter holder cover 1 3D printed part STP file , STL file M2 screw 4 - - M3 screw 6 - - M2 nuts 4 - - M6 screw 1 - - M6 nut 1 - - FEL0750 - \u00d81\" Long pass Filter 1 Thorlabs https://www.thorlabs.de/thorproduct.cfm?partnumber=FEL0750 CP35/M - 30 mm Cage Plate 1 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=CP35/M SM1L03 - SM1 Lens Tube 1 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=SM1L03 FM02R - 25 mm x 36 mm Red Hot Mirror 1 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=FM02R ELP webcam camera 1080P 30fp 1 Amazon https://www.amazon.co.uk/gp/product/B015PCAVZG/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&psc=1","title":"Components"},{"location":"pupil/components/#pupil-tracking-camera-mirror-complex","text":"Additionally, it is possible to add a camera on the head holder. The ELP webcam camera 1080P 30fps was chosen for its small footprint and light weight, and used with a Thorlabs FEL0750 - \u00d81\" Long pass Filter, Cut-Off Wavelength: 750 nm, mounted on a CP35/M - 30 mm Cage Plate with a SM1L03 - SM1 Lens Tube. The image of the animal\u2019s pupil is reflected from the FM02R - 25 mm x 36 mm Red Hot Mirror, AOI: 45\u00b0. The mirror can be adjusted with Thorlabs Posts elements and the camera can be rotated and translated for adequate positioning. Figure 1. Camera with mirror","title":"Pupil tracking camera-mirror complex"},{"location":"pupil/components/#bill-of-materials","text":"Component Quantity Supplier Reference Mirror holder 1 3D printed part STP file , STL file Camera holder 1 3D printed part STP file , STL file Filter holder 1 3D printed part STP file , STL file Filter holder cover 1 3D printed part STP file , STL file M2 screw 4 - - M3 screw 6 - - M2 nuts 4 - - M6 screw 1 - - M6 nut 1 - - FEL0750 - \u00d81\" Long pass Filter 1 Thorlabs https://www.thorlabs.de/thorproduct.cfm?partnumber=FEL0750 CP35/M - 30 mm Cage Plate 1 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=CP35/M SM1L03 - SM1 Lens Tube 1 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=SM1L03 FM02R - 25 mm x 36 mm Red Hot Mirror 1 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=FM02R ELP webcam camera 1080P 30fp 1 Amazon https://www.amazon.co.uk/gp/product/B015PCAVZG/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&psc=1","title":"Bill of materials"},{"location":"screens/VR/","text":"Raspberry Pi The VR environment runs on a Raspberry Pi 4 Modell B located on the platform, running Raspbian 10 (Buster). The Pi is connected to the screens via micro HDMI cables. The Raspberry Pi is powered through one of the USB cables on the slip ring, using a USB to USB-C adaptor. Connections are indicated below Figure 1. Connections to Raspberri Pi4 Sensor input through USB The optical sensor inputs transformed on the Teensy to calculate the motor displacement are converted using the Mouse HID Library, and transmitted to the Pi via USB. Godot Compilation instructions Godot 3.2 is compiled from source using clang. After installing clang and any required libraries (see https://docs.godotengine.org/en/stable/development/compiling/compiling_for_x11.html ), clone and install Godot using the commands below: git clone https://github.com/godotengine/godot cd godot git checkout 3.2-stable scons platform=x11 target=release_debug tools=yes use_llvm=yes CCFLAGS=\"-mtune=cortex-a72 -mcpu=cortex-a72 -mfloat-abi=hard -mfpu=neon-fp-armv8\" -j4 sudo cp bin/godot.x11.opt.tools.32.llvm /usr/bin/godo Environment The 3D environment is created in Godot. The camera position is updated using a script written in GDScript, relative to the movements of the emulated mouse carrying the optical sensor input. The game is run via a bash script that ensures the game is running in full screen mode across the two monitors. The (x,y) coordinates of the player within the environment are automatically saved in a csv file. The virtual corridor is available at https://github.com/atranvan/corridor","title":"Virtual Reality"},{"location":"screens/VR/#raspberry-pi","text":"The VR environment runs on a Raspberry Pi 4 Modell B located on the platform, running Raspbian 10 (Buster). The Pi is connected to the screens via micro HDMI cables. The Raspberry Pi is powered through one of the USB cables on the slip ring, using a USB to USB-C adaptor. Connections are indicated below Figure 1. Connections to Raspberri Pi4","title":"Raspberry Pi"},{"location":"screens/VR/#sensor-input-through-usb","text":"The optical sensor inputs transformed on the Teensy to calculate the motor displacement are converted using the Mouse HID Library, and transmitted to the Pi via USB.","title":"Sensor input through USB"},{"location":"screens/VR/#godot","text":"","title":"Godot"},{"location":"screens/VR/#compilation-instructions","text":"Godot 3.2 is compiled from source using clang. After installing clang and any required libraries (see https://docs.godotengine.org/en/stable/development/compiling/compiling_for_x11.html ), clone and install Godot using the commands below: git clone https://github.com/godotengine/godot cd godot git checkout 3.2-stable scons platform=x11 target=release_debug tools=yes use_llvm=yes CCFLAGS=\"-mtune=cortex-a72 -mcpu=cortex-a72 -mfloat-abi=hard -mfpu=neon-fp-armv8\" -j4 sudo cp bin/godot.x11.opt.tools.32.llvm /usr/bin/godo","title":"Compilation instructions"},{"location":"screens/VR/#environment","text":"The 3D environment is created in Godot. The camera position is updated using a script written in GDScript, relative to the movements of the emulated mouse carrying the optical sensor input. The game is run via a bash script that ensures the game is running in full screen mode across the two monitors. The (x,y) coordinates of the player within the environment are automatically saved in a csv file. The virtual corridor is available at https://github.com/atranvan/corridor","title":"Environment"},{"location":"screens/assembly/","text":"Assembly instructions In order to assembly the screen you just need attach the display with the front and back screen holders using spacers, M4 screws and nuts. Figure 1. Screen assembly Separately assemble the 3D printed Screen attachment 1 with back of the Screen holder. Figure 2. Front holder assembly Attach the electronic board with the screen holder back using 3 M3 screws and nuts. Then attach the two back holders with M4 screws. Figure 3. Back holder assembly Figure 4. Location of the screens on the platform | | | Fgure 5. Final assembly |","title":"Assembly"},{"location":"screens/assembly/#assembly-instructions","text":"In order to assembly the screen you just need attach the display with the front and back screen holders using spacers, M4 screws and nuts. Figure 1. Screen assembly Separately assemble the 3D printed Screen attachment 1 with back of the Screen holder. Figure 2. Front holder assembly Attach the electronic board with the screen holder back using 3 M3 screws and nuts. Then attach the two back holders with M4 screws. Figure 3. Back holder assembly Figure 4. Location of the screens on the platform | | | Fgure 5. Final assembly |","title":"Assembly instructions"},{"location":"screens/components/","text":"Components The two 8\u201d SKD819VAHT-9 TFT displays are attached with the rotary platform using two Thorlabs RS6P_M posts. The displays are attached to the posts with a 3D printed part (Screen attachment 1) and the display frame is composed of three laser cut acrylic parts and some laser cut spacers. Eight M4 screws and nuts are required to build the acrylic structure and an M6 screw is required to attach the 3D printed attachment with the Thorlabs\u00ae post. Bill of materials (for each screen) Component Quantity Supplier Reference Screen 8\" TFT LCD SKD with HDMI 1 - SKD819VAHT-9 Screen holder front 1 Laser cut part STP file , DXF file Screen holder back 1 Laser cut part STP file , DXF file Screen holder back 2 1 Laser cut part STP file , DXF file Screen attachment 1 1 3D printed part STP file , STL file Spacer 4 3D printed part STP file , STL file Spacer 2 4 3D printed part STP file , STL file RS6P_M 1 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=RS6P/M M4 screw 8 RS Components https://uk.rs-online.com/web/p/socket-screws/0281057/ M4 nut 4 RS Components https://uk.rs-online.com/web/p/hex-nuts/0189579/ M6 screw 1 RS Components https://uk.rs-online.com/web/p/socket-screws/8741030/","title":"Components"},{"location":"screens/components/#components","text":"The two 8\u201d SKD819VAHT-9 TFT displays are attached with the rotary platform using two Thorlabs RS6P_M posts. The displays are attached to the posts with a 3D printed part (Screen attachment 1) and the display frame is composed of three laser cut acrylic parts and some laser cut spacers. Eight M4 screws and nuts are required to build the acrylic structure and an M6 screw is required to attach the 3D printed attachment with the Thorlabs\u00ae post.","title":"Components"},{"location":"screens/components/#bill-of-materials-for-each-screen","text":"Component Quantity Supplier Reference Screen 8\" TFT LCD SKD with HDMI 1 - SKD819VAHT-9 Screen holder front 1 Laser cut part STP file , DXF file Screen holder back 1 Laser cut part STP file , DXF file Screen holder back 2 1 Laser cut part STP file , DXF file Screen attachment 1 1 3D printed part STP file , STL file Spacer 4 3D printed part STP file , STL file Spacer 2 4 3D printed part STP file , STL file RS6P_M 1 Thorlabs https://www.thorlabs.com/thorproduct.cfm?partnumber=RS6P/M M4 screw 8 RS Components https://uk.rs-online.com/web/p/socket-screws/0281057/ M4 nut 4 RS Components https://uk.rs-online.com/web/p/hex-nuts/0189579/ M6 screw 1 RS Components https://uk.rs-online.com/web/p/socket-screws/8741030/","title":"Bill of materials (for each screen)"},{"location":"sensors/assembly/","text":"Assembly instructions In order to use the mice sensors, the PCB must be removed from the optical mouse and the VDD, GND, SCK and SDIO must be soldered with wires to be connected to the microcontroller with the microcontroller internal 5V power supply. Figure 1. Soldered pins on the ADNS-2610 All the 3D printable parts must be printed, the parts have been designed to be printed optimally with an Objet 30 (Polyjet resin printer), and have also been printed with a Form 2 (SLS resin printer). The materials used are the Vero gray resin and the Clear V4 resin with the Objet 30 and the Form 2 respectively. For both printers the settings have been the default settings. Figure 2 and 3. Optical sensor assembly Insert the two M3 brass threaded inserts by applying pressure. Attach the sensor on the sensor holder using 2 M3 screws. Follow the instructions on Figure 3 to assemble the three Thorlabs components with the Sensor holder. The lens must be glued to the PCB in the correct position, with the lens aligned with the optical flow sensor. Figure 4. ADNS-2610 glued with the lens Attach the whole assembly on the rotary stage platform where the mark of 90 degrees is. Figure 5. Optical sensor \u2013 platform assembly Optical sensor - platform assembly Connect the pins on the Arduino 5V, GND, and two digital pins.","title":"Assembly"},{"location":"sensors/assembly/#assembly-instructions","text":"In order to use the mice sensors, the PCB must be removed from the optical mouse and the VDD, GND, SCK and SDIO must be soldered with wires to be connected to the microcontroller with the microcontroller internal 5V power supply. Figure 1. Soldered pins on the ADNS-2610 All the 3D printable parts must be printed, the parts have been designed to be printed optimally with an Objet 30 (Polyjet resin printer), and have also been printed with a Form 2 (SLS resin printer). The materials used are the Vero gray resin and the Clear V4 resin with the Objet 30 and the Form 2 respectively. For both printers the settings have been the default settings. Figure 2 and 3. Optical sensor assembly Insert the two M3 brass threaded inserts by applying pressure. Attach the sensor on the sensor holder using 2 M3 screws. Follow the instructions on Figure 3 to assemble the three Thorlabs components with the Sensor holder. The lens must be glued to the PCB in the correct position, with the lens aligned with the optical flow sensor. Figure 4. ADNS-2610 glued with the lens Attach the whole assembly on the rotary stage platform where the mark of 90 degrees is. Figure 5. Optical sensor \u2013 platform assembly Optical sensor - platform assembly Connect the pins on the Arduino 5V, GND, and two digital pins.","title":"Assembly instructions"},{"location":"sensors/characterization/","text":"Sensor characterization The library needed to interface with the sensors is available on GitHub, created by Martijn The and modified by Zapmaker [1] . It gives us have added the access to the SQUAL register, which gives the reading of how good is the surface pattern to detect xy displacements. On Figure 1 you can see the relationship of error in percentage and SQUAL value for one revolution. The maximum SQUAL value was 120 and 0 for no detection of the surface. Figure 1. Relationship between error of the measurement and SQUAL value Characterization The characterization of the ADNS2610 optical sensors was performed collecting 30 revolutions using the different axes of the polystyrene sphere. The results obtained reflected the number of the optical sensor internal units per revolution which are 9.391 pn average. The polystyrene sphere has a perimeter of 61.86 cm, therefore, the number of sensor internal units per cm is equal to 151.81. The SQUAL value was recorded simultaneously and its average value was 82.56 \u00b1 23.92. Figure 2 (left) shows distribution of the SQUAL value. Figure 2 (right) shows the relationship of the speed of rotation as the increment in mouse internal units between two samples and the SQUAL value. Figure 2. Distribution of the SQUAL value (left) and relationship between the speed and the SQUAL value Calibration The calibration can be done adjusting the vertical position of the equator of the sphere to make it coincident with the optical flow sensor. Then the horizontal position can be optimized by adjusting the horizontal micrometer until a SQUAL value higher than 100 has been achieved. Data The data and code used for the sensor validation are available here References [1] https://github.com/zapmaker/OptiMouse","title":"Characterization"},{"location":"sensors/characterization/#sensor-characterization","text":"The library needed to interface with the sensors is available on GitHub, created by Martijn The and modified by Zapmaker [1] . It gives us have added the access to the SQUAL register, which gives the reading of how good is the surface pattern to detect xy displacements. On Figure 1 you can see the relationship of error in percentage and SQUAL value for one revolution. The maximum SQUAL value was 120 and 0 for no detection of the surface. Figure 1. Relationship between error of the measurement and SQUAL value","title":"Sensor characterization"},{"location":"sensors/characterization/#characterization","text":"The characterization of the ADNS2610 optical sensors was performed collecting 30 revolutions using the different axes of the polystyrene sphere. The results obtained reflected the number of the optical sensor internal units per revolution which are 9.391 pn average. The polystyrene sphere has a perimeter of 61.86 cm, therefore, the number of sensor internal units per cm is equal to 151.81. The SQUAL value was recorded simultaneously and its average value was 82.56 \u00b1 23.92. Figure 2 (left) shows distribution of the SQUAL value. Figure 2 (right) shows the relationship of the speed of rotation as the increment in mouse internal units between two samples and the SQUAL value. Figure 2. Distribution of the SQUAL value (left) and relationship between the speed and the SQUAL value","title":"Characterization"},{"location":"sensors/characterization/#calibration","text":"The calibration can be done adjusting the vertical position of the equator of the sphere to make it coincident with the optical flow sensor. Then the horizontal position can be optimized by adjusting the horizontal micrometer until a SQUAL value higher than 100 has been achieved.","title":"Calibration"},{"location":"sensors/characterization/#data","text":"The data and code used for the sensor validation are available here","title":"Data"},{"location":"sensors/characterization/#references","text":"[1] https://github.com/zapmaker/OptiMouse","title":"References"},{"location":"sensors/components/","text":"Optical motion sensors Sensors To measure the position of the sphere we used two PCB boards based on the Avago Technologies ADNS-2610 [1] optical flow sensor and extracted from the Logitech M-SBF96 PS2 computer mouse [2] ]. This sensor presents high reliability for speeds under 30.5 cm/s, and has a register that outputs the SQUAL value, a reference of the quality of the surface. This SQUAL value can be used for the calibration process. Figure 1. Pinout of the ADNS-2610 The PCB and the lens are attached to a 3D printable structure which is assembled with 3 Thorlabs components. Figure 2. Optical sensor Bill of materials (for each sensor) Component Quantity Supplier Reference Optical mouse 1 - https://www.ebay.co.uk/itm/HP-PS2-Optical-Mouse-for-Desktops-Laptops-417966-001/272643457275?ssPageName=STRK%3AMEBIDX%3AIT&_trksid=p2060353.m2749.l2649 Sensor holder 1 3D printed part STEP file , STL file PH75_M 1 Thorlabs RA180_M 1 Thorlabs TR75V_M 1 Thorlabs M3 x 6 mm 2 RS Components 137-720 RS PRO M3 x 6mm Hex Socket Set Screw Plain Stainless Steel M3 threaded insert 2 RS Components 278-534 RS PRO, M3 Brass Threaded Insert diameter 4mm Depth 4.78mm References [1] https://media.digikey.com/pdf/Data%20Sheets/Avago%20PDFs/ADNS-2610.pdf [2] https://www.ebay.co.uk/itm/HP-PS2-Optical-Mouse-for-Desktops-Laptops-417966-001/272643457275?ssPageName=STRK%3AMEBIDX%3AIT&_trksid=p2060353.m2749.l2649","title":"Components"},{"location":"sensors/components/#optical-motion-sensors","text":"","title":"Optical motion sensors"},{"location":"sensors/components/#sensors","text":"To measure the position of the sphere we used two PCB boards based on the Avago Technologies ADNS-2610 [1] optical flow sensor and extracted from the Logitech M-SBF96 PS2 computer mouse [2] ]. This sensor presents high reliability for speeds under 30.5 cm/s, and has a register that outputs the SQUAL value, a reference of the quality of the surface. This SQUAL value can be used for the calibration process. Figure 1. Pinout of the ADNS-2610 The PCB and the lens are attached to a 3D printable structure which is assembled with 3 Thorlabs components. Figure 2. Optical sensor","title":"Sensors"},{"location":"sensors/components/#bill-of-materials-for-each-sensor","text":"Component Quantity Supplier Reference Optical mouse 1 - https://www.ebay.co.uk/itm/HP-PS2-Optical-Mouse-for-Desktops-Laptops-417966-001/272643457275?ssPageName=STRK%3AMEBIDX%3AIT&_trksid=p2060353.m2749.l2649 Sensor holder 1 3D printed part STEP file , STL file PH75_M 1 Thorlabs RA180_M 1 Thorlabs TR75V_M 1 Thorlabs M3 x 6 mm 2 RS Components 137-720 RS PRO M3 x 6mm Hex Socket Set Screw Plain Stainless Steel M3 threaded insert 2 RS Components 278-534 RS PRO, M3 Brass Threaded Insert diameter 4mm Depth 4.78mm","title":"Bill of materials (for each sensor)"},{"location":"sensors/components/#references","text":"[1] https://media.digikey.com/pdf/Data%20Sheets/Avago%20PDFs/ADNS-2610.pdf [2] https://www.ebay.co.uk/itm/HP-PS2-Optical-Mouse-for-Desktops-Laptops-417966-001/272643457275?ssPageName=STRK%3AMEBIDX%3AIT&_trksid=p2060353.m2749.l2649","title":"References"},{"location":"sensors_3050/assembly/","text":"Assembly instructions In order to use the mice sensors, the PCB and the lens must be removed from the optical mouse and the VDD, GND, MISO, MOSI, NCS and SCLK must be soldered with wires to be connected to the microcontroller with the microcontroller 3.3V power supply output. These pins are the pins for SPI communication, the SCLK is the clock selected on the ADNS-3050.h C++ library in our case the Arduino DUE internal clock divided by 21 (4 MHz). The NCS is the pin which allows communication with more than one device by changing the state of this pin to HIGH or LOW. The MOSI and MISO pins are to send the data in both directions. Figure 1. Soldered pins on the ADNS-3050 The lens and the PCB are assembled with the PCB holder part 1 and 2 placing the lens as in Figure 1 and inserting the screws to attach both parts together. Figure 2. ADNS-3050 assembled with the lens. The provided library is the library created by Tom Wiggins on GitHub [1] for a 3D printable gaming optical mouse, a project also published on Hackaday [2]. The library has been modified duplicating the functions needed to control and get data from two optical mice. References [1] https://github.com/Tom101222/Adns-3050-Optical-Sensor [2] https://hackaday.io/project/18344-adns-3050-optical-sensor-mouse","title":"Assembly"},{"location":"sensors_3050/assembly/#assembly-instructions","text":"In order to use the mice sensors, the PCB and the lens must be removed from the optical mouse and the VDD, GND, MISO, MOSI, NCS and SCLK must be soldered with wires to be connected to the microcontroller with the microcontroller 3.3V power supply output. These pins are the pins for SPI communication, the SCLK is the clock selected on the ADNS-3050.h C++ library in our case the Arduino DUE internal clock divided by 21 (4 MHz). The NCS is the pin which allows communication with more than one device by changing the state of this pin to HIGH or LOW. The MOSI and MISO pins are to send the data in both directions. Figure 1. Soldered pins on the ADNS-3050 The lens and the PCB are assembled with the PCB holder part 1 and 2 placing the lens as in Figure 1 and inserting the screws to attach both parts together. Figure 2. ADNS-3050 assembled with the lens. The provided library is the library created by Tom Wiggins on GitHub [1] for a 3D printable gaming optical mouse, a project also published on Hackaday [2]. The library has been modified duplicating the functions needed to control and get data from two optical mice.","title":"Assembly instructions"},{"location":"sensors_3050/assembly/#references","text":"[1] https://github.com/Tom101222/Adns-3050-Optical-Sensor [2] https://hackaday.io/project/18344-adns-3050-optical-sensor-mouse","title":"References"},{"location":"sensors_3050/characterization/","text":"Characterization Before calibration, the position of the sensor needs to be adjusted, first using the vertical micrometer to make the optical flow sensor coincident the equator of the sphere with the optical flow sensor. Then the horizontal position can be adjusted using the horizontal micrometer until we reach a SQUAL value of approximately 50. Several recordings of 5 seconds at 1000 Hz are performed to characterize the perimeter measured by the sensor and establish the relationship between the actual and measured perimeter. The recordings have been divided by rotating the sphere around the yaw and roll axes (Figure 1). Figure 1. SQUAL value recordings for both axes Figure 2. Distribution of the SQUAL value on each axis The results show a homogeneous distribution of the SQUAL value depending on the relative distance change (Figure 3). Figure 3. Relationship between relative displacements and the SQUAL value The calibration was performed by repeating several measurements of one revolution for the roll and yaw axes (N=6 and N=5, respectively). For each recording, the sphere has been rotated by one revolution using an external mark. Figure 4. Recordings of absolute displacements in roll and yaw axes of one revolution As can be observed in Figure 4, for both axes the recordings converge towards a final value. The conversion factor between mouse internal units and cm is the average of this absolute final value for both axes (N=11). The average final value is 21,966 for the roll axis and 20,109 mouse internal units for the yaw axis, giving a final average of 21,038 mouse internal units for a perimeter of 61.89 cm, hence a conversion factor of 339.92 mouse internal units per cm.","title":"Characterization"},{"location":"sensors_3050/characterization/#characterization","text":"Before calibration, the position of the sensor needs to be adjusted, first using the vertical micrometer to make the optical flow sensor coincident the equator of the sphere with the optical flow sensor. Then the horizontal position can be adjusted using the horizontal micrometer until we reach a SQUAL value of approximately 50. Several recordings of 5 seconds at 1000 Hz are performed to characterize the perimeter measured by the sensor and establish the relationship between the actual and measured perimeter. The recordings have been divided by rotating the sphere around the yaw and roll axes (Figure 1). Figure 1. SQUAL value recordings for both axes Figure 2. Distribution of the SQUAL value on each axis The results show a homogeneous distribution of the SQUAL value depending on the relative distance change (Figure 3). Figure 3. Relationship between relative displacements and the SQUAL value The calibration was performed by repeating several measurements of one revolution for the roll and yaw axes (N=6 and N=5, respectively). For each recording, the sphere has been rotated by one revolution using an external mark. Figure 4. Recordings of absolute displacements in roll and yaw axes of one revolution As can be observed in Figure 4, for both axes the recordings converge towards a final value. The conversion factor between mouse internal units and cm is the average of this absolute final value for both axes (N=11). The average final value is 21,966 for the roll axis and 20,109 mouse internal units for the yaw axis, giving a final average of 21,038 mouse internal units for a perimeter of 61.89 cm, hence a conversion factor of 339.92 mouse internal units per cm.","title":"Characterization"},{"location":"sensors_3050/components/","text":"Optical motion sensors - option 2, ADNS-3050 Sensors Another option to measure the position of the sphere is to use two PCB boards based on the Avago Technologies ADNS-3050 optical flow sensor [1]. The sensor were extracted from the Cougar Minos X2 gaming computer mouse [2]. This sensor has high motion detection under speeds of 152.4 cm/s and can deal with accelerations up to 20G. It has selectable resolutions up to 2000 cpi (we have used the default configuration of 1000 cpi). The register outputs the SQUAL value, which is used for the calibration process. Figure 1. Pinout of the ADNS-3050 Bill of materials (for each sensor) Component Quantity Supplier Reference Optical mouse 1 - https://www.ebay.co.uk/itm/HP-PS2-Optical-Mouse-for-Desktops-Laptops-417966-001/272643457275?ssPageName=STRK%3AMEBIDX%3AIT&_trksid=p2060353.m2749.l2649 PCB Holder 1 3D printed part STEP file , STL file PCB Holder 2 1 3D printed part STEP file , STL file M3 screws 4 RS Components The rest of the components are the same as described in the ADNS 2610 assembly. References [1] https://media.digikey.com/pdf/data%20sheets/avago%20pdfs/adns-3050.pdf [2] https://cougargaming.com/products/mice/minos_x2/","title":"Components"},{"location":"sensors_3050/components/#optical-motion-sensors-option-2-adns-3050","text":"","title":"Optical motion sensors - option 2, ADNS-3050"},{"location":"sensors_3050/components/#sensors","text":"Another option to measure the position of the sphere is to use two PCB boards based on the Avago Technologies ADNS-3050 optical flow sensor [1]. The sensor were extracted from the Cougar Minos X2 gaming computer mouse [2]. This sensor has high motion detection under speeds of 152.4 cm/s and can deal with accelerations up to 20G. It has selectable resolutions up to 2000 cpi (we have used the default configuration of 1000 cpi). The register outputs the SQUAL value, which is used for the calibration process. Figure 1. Pinout of the ADNS-3050","title":"Sensors"},{"location":"sensors_3050/components/#bill-of-materials-for-each-sensor","text":"Component Quantity Supplier Reference Optical mouse 1 - https://www.ebay.co.uk/itm/HP-PS2-Optical-Mouse-for-Desktops-Laptops-417966-001/272643457275?ssPageName=STRK%3AMEBIDX%3AIT&_trksid=p2060353.m2749.l2649 PCB Holder 1 3D printed part STEP file , STL file PCB Holder 2 1 3D printed part STEP file , STL file M3 screws 4 RS Components The rest of the components are the same as described in the ADNS 2610 assembly.","title":"Bill of materials (for each sensor)"},{"location":"sensors_3050/components/#references","text":"[1] https://media.digikey.com/pdf/data%20sheets/avago%20pdfs/adns-3050.pdf [2] https://cougargaming.com/products/mice/minos_x2/","title":"References"},{"location":"sensors_3360/components/","text":"Components The PWM3360 has exceptional capabilities: high motion detection under speeds of 635 cm/s, and can deal with accelerations up to 50G. The register outputs the SQUAL value, a reference of the quality of the surface. The sensor is available for purchase from JACK Enterprises in Tindie [1]. In order to control it you will need to download the library PWM3360 from Sunjun Kim [1]. The breakout board has the essential pins available and distributed in a way that makes it easy to connect: VI = 3.3V MI = MISO0 -or- DIN MO = MOSI0 -or- DOUT SC = SCK0 -or- SCK SS = CS0 -or- CS GD = GND The holder can be quickly 3D printed ( STL file and STP file ) and can be used with the Thorlabs parts described for the other sensors (ADNS 2610 and 3050). To attach the sensor with the holder only two M2.5 16 mm pan head screws and two M2.5 nuts are needed. The nuts can be pressed to fit on the holder and the bolts will hold the lens against the sensor without the need of glue (Figure 1): Figure 1. P3D printed holder and screw holding system References [1] https://www.tindie.com/products/jkicklighter/pmw3360-motion-sensor/ [2] https://github.com/SunjunKim/PMW3360","title":"Components"},{"location":"sensors_3360/components/#components","text":"The PWM3360 has exceptional capabilities: high motion detection under speeds of 635 cm/s, and can deal with accelerations up to 50G. The register outputs the SQUAL value, a reference of the quality of the surface. The sensor is available for purchase from JACK Enterprises in Tindie [1]. In order to control it you will need to download the library PWM3360 from Sunjun Kim [1]. The breakout board has the essential pins available and distributed in a way that makes it easy to connect: VI = 3.3V MI = MISO0 -or- DIN MO = MOSI0 -or- DOUT SC = SCK0 -or- SCK SS = CS0 -or- CS GD = GND The holder can be quickly 3D printed ( STL file and STP file ) and can be used with the Thorlabs parts described for the other sensors (ADNS 2610 and 3050). To attach the sensor with the holder only two M2.5 16 mm pan head screws and two M2.5 nuts are needed. The nuts can be pressed to fit on the holder and the bolts will hold the lens against the sensor without the need of glue (Figure 1): Figure 1. P3D printed holder and screw holding system","title":"Components"},{"location":"sensors_3360/components/#references","text":"[1] https://www.tindie.com/products/jkicklighter/pmw3360-motion-sensor/ [2] https://github.com/SunjunKim/PMW3360","title":"References"},{"location":"troubleshooting/troubleshooting/","text":"Do you hear a friction noise? Probably is the rotary joint spacer making contact with the slipring/rotary joint. One solution is to slide the Thorlabs posts to create a space between the two. The platform does not mimic sphere rotation in the closed loop program and makes random movements or just spins indefinitely? That might be caused for a bad connection of the wires of the sensor, check the connections on the control board (screw connectors) make sure they are coincident with the pinout proposed on the schematic. Check the soldering on the optical sensor board.","title":"Troubleshooting"},{"location":"troubleshooting/troubleshooting/#do-you-hear-a-friction-noise","text":"Probably is the rotary joint spacer making contact with the slipring/rotary joint. One solution is to slide the Thorlabs posts to create a space between the two.","title":"Do you hear a friction noise?"},{"location":"troubleshooting/troubleshooting/#the-platform-does-not-mimic-sphere-rotation-in-the-closed-loop-program-and-makes-random-movements-or-just-spins-indefinitely","text":"That might be caused for a bad connection of the wires of the sensor, check the connections on the control board (screw connectors) make sure they are coincident with the pinout proposed on the schematic. Check the soldering on the optical sensor board.","title":"The platform does not mimic sphere rotation in the closed loop program and makes random movements or just spins indefinitely?"},{"location":"wiring/config/","text":"Setup driver configuration The configuration of the motor driver for the position control is the corresponding to 25,000 steps per revolution on the motor shaft (150,000 steps per revolution on the rotary table): In order to control the closed loop response, we have explored how the different configurations of micro stepping of the driver DM542A match with the internal units of the optical motion sensor. In the case of the ADNS 2610, the measured average number of internal units per revolution is 9,391 and therefore the best micro stepping configuration is of 25,000 steps per revolution. The reason why we have chosen this configuration is because we have evaluated the relationship between the number of steps and the sensor internal units in each possible micro stepping configuration. The number of steps on the big pulley is 150,000 steps with a gear ratio of 6 between small and big pulley. Therefore, the number of steps per optical sensor unit is 15.97 steps. This configuration is also the most silent and helps reducing vibrations on the platform. To efficiently control the stepper motor we have used the TeensyStep library [1] which can control multiple stepper motors precisely at high speeds (300,000 steps/s) and accelerations (500,000 steps/s^2). We have implemented a proportional control between the angle measured on the Styrofoam sphere as a set point and the angle of the stepper motor measured from the internal counter of the stepper object using the method stepper.getPosition() [2] . The Proportional control uses the method controller.overrideSpeed() in order to change the rotational speed on the fly The encoder can be used to record the position separately or implement a close loop control using the encoder as a position reference. The range of speed and acceleration we have tested with the rotary stage vary from 20 to 100 deg/s and 200 to 1200 deg/s^2. The main loop() execution period on the Teensy 3.5 at 120 MHz is approximately 270 \u00b5s therefore the program execution frequency is higher than 3 kHz where the position of the sensor is evaluated and sent to the stepper motor. Warning If the speed is increased the system will tend to overshoot, compromising the proportional constant (kp) of the control algorithm might have to be adjusted in order to get a better performance. That said, with the kp you will find on our code examples we always got good results. References [1] https://luni64.github.io/TeensyStep/ [2] https://forum.pjrc.com/threads/43491-New-Stepper-Motor-Library/page3","title":"Driver configuration"},{"location":"wiring/config/#setup-driver-configuration","text":"The configuration of the motor driver for the position control is the corresponding to 25,000 steps per revolution on the motor shaft (150,000 steps per revolution on the rotary table): In order to control the closed loop response, we have explored how the different configurations of micro stepping of the driver DM542A match with the internal units of the optical motion sensor. In the case of the ADNS 2610, the measured average number of internal units per revolution is 9,391 and therefore the best micro stepping configuration is of 25,000 steps per revolution. The reason why we have chosen this configuration is because we have evaluated the relationship between the number of steps and the sensor internal units in each possible micro stepping configuration. The number of steps on the big pulley is 150,000 steps with a gear ratio of 6 between small and big pulley. Therefore, the number of steps per optical sensor unit is 15.97 steps. This configuration is also the most silent and helps reducing vibrations on the platform. To efficiently control the stepper motor we have used the TeensyStep library [1] which can control multiple stepper motors precisely at high speeds (300,000 steps/s) and accelerations (500,000 steps/s^2). We have implemented a proportional control between the angle measured on the Styrofoam sphere as a set point and the angle of the stepper motor measured from the internal counter of the stepper object using the method stepper.getPosition() [2] . The Proportional control uses the method controller.overrideSpeed() in order to change the rotational speed on the fly The encoder can be used to record the position separately or implement a close loop control using the encoder as a position reference. The range of speed and acceleration we have tested with the rotary stage vary from 20 to 100 deg/s and 200 to 1200 deg/s^2. The main loop() execution period on the Teensy 3.5 at 120 MHz is approximately 270 \u00b5s therefore the program execution frequency is higher than 3 kHz where the position of the sensor is evaluated and sent to the stepper motor. Warning If the speed is increased the system will tend to overshoot, compromising the proportional constant (kp) of the control algorithm might have to be adjusted in order to get a better performance. That said, with the kp you will find on our code examples we always got good results.","title":"Setup driver configuration"},{"location":"wiring/config/#references","text":"[1] https://luni64.github.io/TeensyStep/ [2] https://forum.pjrc.com/threads/43491-New-Stepper-Motor-Library/page3","title":"References"},{"location":"wiring/wiring/","text":"Schematics and electrical connections The device is controlled using a custom PCB which connects the Teensy 3.5 development board with the DM542 stepper motor driver. The board is supplied at 24V and it has the voltage regulators to provide a 5V power supply to the Teensy. In addition, there are two bi-directional logic level shifters (5-3.3V), so up to eight 5V signals can be converted to 3.3V. We added two BNC connectors connected to the two Teensy DAC, SPI pins (3.3V) and some extra digital pins at 3.3V. Figure 1. PCB description Figure 2. PCB with components soldered A simplified version of the connections of the setup is shown in Figure 3: Figure 3. Setup connections Recommendation For electophysiological recordings, make sure all electronics components are located 50cm away from the rotary stage. The emergency stop opens the 24V power supply circuit, the whole experimental device is disconnected if is pressed. Warning Before soldering the Emergency stop pins check the continuity between and the logic operation between pins. If the button is pressed, the circuit must be open. Figure 4. Emergency stop connections Bill of materials Component Quantity Supplier Reference PCB 1 - Gerber files Electronics Logic Level Converter Module 2 Amazon https://www.amazon.co.uk/gp/product/B0148BLZGE/ref=ppx_yo_dt_b_asin_title_o05_s00?ie=UTF8&psc=1 Teensy 3.5 1 PJRC https://www.pjrc.com/store/teensy35.html BNC connectors 2 RS Components https://uk.rs-online.com/web/p/coaxial-connectors/7100453/ 12V voltage regulator L7812CV 1 RS Components https://uk.rs-online.com/web/p/linear-voltage-regulators/7931355/ 5V voltage regulator LM7805 1 RS Components https://uk.rs-online.com/web/p/linear-voltage-regulators/7968060/ Electrolytic capacitor 330 \u03bcF 25V 1 Ebay https://www.ebay.co.uk/c/16029438608?iid=303554359855 Electrolytic capacitor 47 \u03bcF 50V 1 Ebay Electrolytic capacitor 1 \u03bcF 50V 1 Ebay Ceramic capacitor 100 nF 25V 2 RS Components https://uk.rs-online.com/web/p/mlccs-multilayer-ceramic-capacitors/5381203/ Ceramic capacitor 330 nF 25V 2 RS Components https://uk.rs-online.com/web/p/mlccs-multilayer-ceramic-capacitors/1726542/ Standard female pin headers 6 Amazon https://www.amazon.co.uk/Aussel-Pieces-Breakaway-Connector-Arduino-PIN-2-20PCS/dp/B01M69EA9O/ref=sr_1_3?dchild=1&keywords=female+pin+header&qid=1612883053&sr=8-3 Emergency stop 1 RS Components https://uk.rs-online.com/web/p/emergency-stop-push-buttons/4774890 Hall efect sensor 1 Amazon https://www.amazon.co.uk/gp/product/B06XHG9CYN/ref=ppx_yo_dt_b_asin_title_o07_s00?ie=UTF8&psc=1","title":"Connections"},{"location":"wiring/wiring/#schematics-and-electrical-connections","text":"The device is controlled using a custom PCB which connects the Teensy 3.5 development board with the DM542 stepper motor driver. The board is supplied at 24V and it has the voltage regulators to provide a 5V power supply to the Teensy. In addition, there are two bi-directional logic level shifters (5-3.3V), so up to eight 5V signals can be converted to 3.3V. We added two BNC connectors connected to the two Teensy DAC, SPI pins (3.3V) and some extra digital pins at 3.3V. Figure 1. PCB description Figure 2. PCB with components soldered A simplified version of the connections of the setup is shown in Figure 3: Figure 3. Setup connections Recommendation For electophysiological recordings, make sure all electronics components are located 50cm away from the rotary stage. The emergency stop opens the 24V power supply circuit, the whole experimental device is disconnected if is pressed. Warning Before soldering the Emergency stop pins check the continuity between and the logic operation between pins. If the button is pressed, the circuit must be open. Figure 4. Emergency stop connections","title":"Schematics and electrical connections"},{"location":"wiring/wiring/#bill-of-materials","text":"Component Quantity Supplier Reference PCB 1 - Gerber files Electronics Logic Level Converter Module 2 Amazon https://www.amazon.co.uk/gp/product/B0148BLZGE/ref=ppx_yo_dt_b_asin_title_o05_s00?ie=UTF8&psc=1 Teensy 3.5 1 PJRC https://www.pjrc.com/store/teensy35.html BNC connectors 2 RS Components https://uk.rs-online.com/web/p/coaxial-connectors/7100453/ 12V voltage regulator L7812CV 1 RS Components https://uk.rs-online.com/web/p/linear-voltage-regulators/7931355/ 5V voltage regulator LM7805 1 RS Components https://uk.rs-online.com/web/p/linear-voltage-regulators/7968060/ Electrolytic capacitor 330 \u03bcF 25V 1 Ebay https://www.ebay.co.uk/c/16029438608?iid=303554359855 Electrolytic capacitor 47 \u03bcF 50V 1 Ebay Electrolytic capacitor 1 \u03bcF 50V 1 Ebay Ceramic capacitor 100 nF 25V 2 RS Components https://uk.rs-online.com/web/p/mlccs-multilayer-ceramic-capacitors/5381203/ Ceramic capacitor 330 nF 25V 2 RS Components https://uk.rs-online.com/web/p/mlccs-multilayer-ceramic-capacitors/1726542/ Standard female pin headers 6 Amazon https://www.amazon.co.uk/Aussel-Pieces-Breakaway-Connector-Arduino-PIN-2-20PCS/dp/B01M69EA9O/ref=sr_1_3?dchild=1&keywords=female+pin+header&qid=1612883053&sr=8-3 Emergency stop 1 RS Components https://uk.rs-online.com/web/p/emergency-stop-push-buttons/4774890 Hall efect sensor 1 Amazon https://www.amazon.co.uk/gp/product/B06XHG9CYN/ref=ppx_yo_dt_b_asin_title_o07_s00?ie=UTF8&psc=1","title":"Bill of materials"}]}