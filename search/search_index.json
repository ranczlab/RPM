{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"RPM - a Rotation Platform for head-fixed Mice Overview This device provides vestibular stimulation for head-fixed experiments in mice. It can be combined with different physiological and behavioural recording modalities. It follows a modular, low-cost and open-source model. This documentation provides the assembly and operation guide for users with some experience in rapid manufacturing, electronics and development boards/microcontrollers, such as Arduino. In the accompanying paper (link_goes_here) , we show use cases for pupil tracking and recording head-direction cell activity during rotation. Figure 1. Main components of the rotation platform Features fully open source low cost easy to assemble modular design, modules can be added depending on experimental needs Main components The main components of the stage are labelled in the figure above. The rotary platform is actuated by a stepper motor using a timing belt. An incremental encoder is coupled with the motor shaft to measure the angular position, while a Hall effect sensor is used for homing purposes. Compressed air keeps a polystyrene sphere floating without friction inside the sphere holder. The crossed roller bearing holds the rotating and non-rotating parts together. The rotary joint enables multiple electric connections between the rotary platform and the base. The device is intended for behavioural experiments combined with extracellular recording and optogenetics. There are two operating modes: closed-loop and open-loop. In closed-loop mode, the sphere's rotation on the horizontal (yaw) axis is measured using an optical sensor and is used to generate a motor rotation of an adjustable magnitude in the opposite direction. In open-loop mode, motor rotation is independent of the animal\u2019s movement and can be controlled by the experimenter.","title":"Home"},{"location":"#rpm-a-rotation-platform-for-head-fixed-mice","text":"","title":"RPM - a Rotation Platform for head-fixed Mice"},{"location":"#overview","text":"This device provides vestibular stimulation for head-fixed experiments in mice. It can be combined with different physiological and behavioural recording modalities. It follows a modular, low-cost and open-source model. This documentation provides the assembly and operation guide for users with some experience in rapid manufacturing, electronics and development boards/microcontrollers, such as Arduino. In the accompanying paper (link_goes_here) , we show use cases for pupil tracking and recording head-direction cell activity during rotation. Figure 1. Main components of the rotation platform","title":"Overview"},{"location":"#features","text":"fully open source low cost easy to assemble modular design, modules can be added depending on experimental needs","title":"Features"},{"location":"#main-components","text":"The main components of the stage are labelled in the figure above. The rotary platform is actuated by a stepper motor using a timing belt. An incremental encoder is coupled with the motor shaft to measure the angular position, while a Hall effect sensor is used for homing purposes. Compressed air keeps a polystyrene sphere floating without friction inside the sphere holder. The crossed roller bearing holds the rotating and non-rotating parts together. The rotary joint enables multiple electric connections between the rotary platform and the base. The device is intended for behavioural experiments combined with extracellular recording and optogenetics. There are two operating modes: closed-loop and open-loop. In closed-loop mode, the sphere's rotation on the horizontal (yaw) axis is measured using an optical sensor and is used to generate a motor rotation of an adjustable magnitude in the opposite direction. In open-loop mode, motor rotation is independent of the animal\u2019s movement and can be controlled by the experimenter.","title":"Main components"},{"location":"characterization/characterization/","text":"Terminology and measurements in this section follow this document . Users should conduct their own characterization with the specific platform weights and weight distributions. The rotary stage's accuracy and repeatability have been evaluated by recording the angle (\u00b0) of the incremental encoder (2400 pulses per revolution) and the angle obtained from the teensystep step counter simultaneously. Figure 1 shows an example test of the stage performance, in this case without the load of the head holder. The stage is repeatedly sent to the set point positions (0 and 360 degrees). The final positions are highly accurate (360.06 \u00b1 0.11\u00b0 and 0.04 \u00b1 0.07\u00b0), suggesting little error accumulation. Figure 1. Rotary stage performance Data and code for this characterization are available here . Minimum incremental motion (MIM) and backlash The minimum incremental motion reliably measured corresponds to 0.1 degrees. The backlash, in the worst-case scenario corresponding to the offset created by the change in direction of the MIM tests, has been 0.04 degrees. Figure 2. Minimum incremental motion measurement Data and code for this characterization are available here . Accuracy and repeatability In order to evaluate the accuracy and repeatability of the rotary stage, a sequence of increments of 45 degrees in both rotation directions has been performed, collecting 8 position deviations in each direction (16 per each velocity/acceleration condition). The overall accuracy and repeatability have been calculated from all conditions according to the following equations: Accuracy: Repeatability: Where x i and s i are the average inaccuracy and the standard deviation, respectively, at position i. Up and down arrows represent the positive and negative directions. Figure 3. Accuracy and repeatability test sequence (a) and average of absolute position deviation in every angular velocity and acceleration condition (b) Closed-loop characterization For the closed loop algorithm, the stability of the system response has been evaluated by the analysis of the step response for all previously described conditions (20-100 \u00b0\u00b7s\u00af\u00b9 and 200-1200 \u00b0\u00b7s\u00af\u00b2). A contour plot has been extracted to be used as a map to avoid regions of inaccuracy and instability. Sometimes even achieving a small error the stage can overshoot as shown in Figure 4 (right). Figure 4. Example step functions (0-90\u00b0) at different velocity and acceleration values. (left) 20 \u00b0\u00b7s\u00af\u00b9, 200 \u00b0\u00b7s\u00af\u00b2. (right) 100 \u00b0\u00b7s\u00af\u00b9, 1200 \u00b0\u00b7s\u00af\u00b2. Figures 5 highlight regions in red to avoid errors and instability around the setpoint. Figure 5. Average (left) and standard deviation (right) of the absolute position deviation. Data and code for this characterization are available here . Specifications and characterization of the rotary stage parameter value Resolution stepper motor (\u00b0) 0.0024 Resolution of the encoder (\u00b0) 0.024 Accuracy (\u00b0) 0.37 Repeatability (\u00b0) 0.1 Minimum incremental motion (\u00b0) 0.1 Maximum angular velocity (\u00b0\u00b7s\u00af\u00b9) 100 Maximum angular acceleration (\u00b0\u00b7s\u00af\u00b2) 1200 Backlash (\u00b0) 0.04","title":"Platform characterization"},{"location":"characterization/characterization/#minimum-incremental-motion-mim-and-backlash","text":"The minimum incremental motion reliably measured corresponds to 0.1 degrees. The backlash, in the worst-case scenario corresponding to the offset created by the change in direction of the MIM tests, has been 0.04 degrees. Figure 2. Minimum incremental motion measurement Data and code for this characterization are available here .","title":"Minimum incremental motion (MIM) and backlash"},{"location":"characterization/characterization/#accuracy-and-repeatability","text":"In order to evaluate the accuracy and repeatability of the rotary stage, a sequence of increments of 45 degrees in both rotation directions has been performed, collecting 8 position deviations in each direction (16 per each velocity/acceleration condition). The overall accuracy and repeatability have been calculated from all conditions according to the following equations: Accuracy: Repeatability: Where x i and s i are the average inaccuracy and the standard deviation, respectively, at position i. Up and down arrows represent the positive and negative directions. Figure 3. Accuracy and repeatability test sequence (a) and average of absolute position deviation in every angular velocity and acceleration condition (b)","title":"Accuracy and repeatability"},{"location":"characterization/characterization/#closed-loop-characterization","text":"For the closed loop algorithm, the stability of the system response has been evaluated by the analysis of the step response for all previously described conditions (20-100 \u00b0\u00b7s\u00af\u00b9 and 200-1200 \u00b0\u00b7s\u00af\u00b2). A contour plot has been extracted to be used as a map to avoid regions of inaccuracy and instability. Sometimes even achieving a small error the stage can overshoot as shown in Figure 4 (right). Figure 4. Example step functions (0-90\u00b0) at different velocity and acceleration values. (left) 20 \u00b0\u00b7s\u00af\u00b9, 200 \u00b0\u00b7s\u00af\u00b2. (right) 100 \u00b0\u00b7s\u00af\u00b9, 1200 \u00b0\u00b7s\u00af\u00b2. Figures 5 highlight regions in red to avoid errors and instability around the setpoint. Figure 5. Average (left) and standard deviation (right) of the absolute position deviation. Data and code for this characterization are available here .","title":"Closed-loop characterization"},{"location":"characterization/characterization/#specifications-and-characterization-of-the-rotary-stage","text":"parameter value Resolution stepper motor (\u00b0) 0.0024 Resolution of the encoder (\u00b0) 0.024 Accuracy (\u00b0) 0.37 Repeatability (\u00b0) 0.1 Minimum incremental motion (\u00b0) 0.1 Maximum angular velocity (\u00b0\u00b7s\u00af\u00b9) 100 Maximum angular acceleration (\u00b0\u00b7s\u00af\u00b2) 1200 Backlash (\u00b0) 0.04","title":"Specifications and characterization of the rotary stage"},{"location":"characterization/requirements/","text":"Required libraries and software packages Software packages Arduino IDE Teensyduino Required Libraries Arduino ADNS 2160 optical sensor with SQUAL readout (based on the OptiMouse library ) Stepper motor control Encoder Libraries for alternative optical sensors These are Optical motion sensor options with higher capabilities than the ADNS 2160. All of them use the SPI bus. ADNS 3500 PWM3360 ADNS 9800 Arduino code examples Closed_loop.ino The closed loop example uses the optically measured angle increment as a setpoint for the proportional motor control. The animal controls the rotation of the platform. Open_loop.ino The Open loop example uses two user-defined variables (eg. 0-360 degrees) as setpoints to oscillate between at a user-defined interval. Open_loop_SD.ino Like the open loop example, but saving the different variables on the SD card on the Teensy 3.5 microcontroller. This program was used to record the accuracy and repeatability measurements. Open_loop_moveAsync.ino Like Open_loop_SD.ino, but instead of using the proportional control, rotation movement is controlled by the teensystep moveAsync() method, using a non-blocking trapezoidal profile.","title":"Software"},{"location":"characterization/requirements/#required-libraries-and-software-packages","text":"","title":"Required libraries and software packages"},{"location":"characterization/requirements/#software-packages","text":"Arduino IDE Teensyduino","title":"Software packages"},{"location":"characterization/requirements/#required-libraries","text":"Arduino ADNS 2160 optical sensor with SQUAL readout (based on the OptiMouse library ) Stepper motor control Encoder","title":"Required Libraries"},{"location":"characterization/requirements/#libraries-for-alternative-optical-sensors","text":"These are Optical motion sensor options with higher capabilities than the ADNS 2160. All of them use the SPI bus. ADNS 3500 PWM3360 ADNS 9800","title":"Libraries for alternative optical sensors"},{"location":"characterization/requirements/#arduino-code-examples","text":"","title":"Arduino code examples"},{"location":"characterization/requirements/#closed_loopino","text":"The closed loop example uses the optically measured angle increment as a setpoint for the proportional motor control. The animal controls the rotation of the platform.","title":"Closed_loop.ino"},{"location":"characterization/requirements/#open_loopino","text":"The Open loop example uses two user-defined variables (eg. 0-360 degrees) as setpoints to oscillate between at a user-defined interval.","title":"Open_loop.ino"},{"location":"characterization/requirements/#open_loop_sdino","text":"Like the open loop example, but saving the different variables on the SD card on the Teensy 3.5 microcontroller. This program was used to record the accuracy and repeatability measurements.","title":"Open_loop_SD.ino"},{"location":"characterization/requirements/#open_loop_moveasyncino","text":"Like Open_loop_SD.ino, but instead of using the proportional control, rotation movement is controlled by the teensystep moveAsync() method, using a non-blocking trapezoidal profile.","title":"Open_loop_moveAsync.ino"},{"location":"holders/assembly/","text":"Assembly We show an example assembly using the MT1/M linker with camera holder lip, the Head-plate holder 2, the MM33 micromanipulator and the probe holder. :--: Head-holding system assembly The head-plate is secured in the head-plate holder using 2 M2.5 screws. For this end, 2 M2.5 nuts are inserted into the head-plate holder. Head-plate holder nuts insertion Finally, the assembly is secured to the ring-shaped instrument platform with M6 screws and connected to the rotary platform using RS6P/M posts. Head holding system and instrument ring assembly","title":"Assembly"},{"location":"holders/assembly/#assembly","text":"We show an example assembly using the MT1/M linker with camera holder lip, the Head-plate holder 2, the MM33 micromanipulator and the probe holder. :--: Head-holding system assembly The head-plate is secured in the head-plate holder using 2 M2.5 screws. For this end, 2 M2.5 nuts are inserted into the head-plate holder. Head-plate holder nuts insertion Finally, the assembly is secured to the ring-shaped instrument platform with M6 screws and connected to the rotary platform using RS6P/M posts. Head holding system and instrument ring assembly","title":"Assembly"},{"location":"holders/components/","text":"Instrument ring A ring-shaped instrument platform can be mounted around the sphere to hold several devices, such as an animal head-holder, cameras, and manipulators for electrical recording and optogenetic stimulation. Below we present options for head-clamps and holders for manipulating recording probes or optical fibres. Figure 1. Ring platform and head holding system Head-plate holder We designed a head fixation system with three degrees of freedom. The height of the head-plate holder can be adjusted to accommodate mice of different sizes. In addition, two orthogonal axes are used in the horizontal plane to adjust the position of the animal's head. This is particularly useful for vestibular experiments to centre the platform rotation axis on the vestibular organ of interest. This head holding system is based on assembling 3 manual Thorlabs translational stages (MT1\\M) to ensure reliability and repeatability across experiments. The resolution of the system is 10 microns with a range of 13 mm in all directions. Figure 2. Virtual assembly of the head post (left) and real assembly (right). The materials needed for the assembly are: 3D printable parts (MT1/M linker, Head plate holder 1), the three MT1\\M translational stages, three MT405 side mounted actuator adapters, two M2.5 nuts, two hexagonal M2.5 screws, fifteen M6 screws (two of them optional) and two M6 threaded inserts (optional). Figure 3. Drawings of the MT1/M linker at 1:2 scale We also provide an MT1/M linker with a side-lip useable for attaching e.g. a camera or another instrument. An alternative Head-plate holder 2 is provided for attaching an MM33 manual micromanipulator. Probe holder and optic fibre holder A probe holder is provided for attaching e.g. a Neuronexus adaptor (Adpt-A32-OM32) to the MM33 micromanipulator for electrophysiological recordings. For optogenetic stimulation, an optic fibre can be secured to the MM33 micromanipulator using the Thorlabs FCM13/M ferrule clamp and a custom 3D printed adaptor. This allows the positioning of the light source at the desired location over the animal's head. Figure 6. Optical fiber holder Bill of materials The 3D printed parts have been printed using a Form2 SLS 3D printer using the default settings with Clear V4 resin type. Component Manufacturer Units Reference Instrument ring 3D printed 1 STP file , STL files MT1/M linker 3D printed 1 STP file MT1/M linker with camera holder lip 3D printed 1 STP file , STL files Head-plate holder 1 3D printed 1 STP file Head-plate holder 2 (for MM33 manipulator) 3D printed 1 STP file , STL file Probe holder 3D printed 1 STP file Optic fiber holder 3D printed 1 STP file , STL file MT1/M translational stage Thorlabs 3 link MT405 side mounted actuator adapter Thorlabs 3 link RS6P/M posts Thorlabs 2 link M6 hex bold screws 16mm length RS components 15 (2 optional) link M2.5 hex bold screws RS components 4 link M2.5 nuts RS components 2 link M6 threaded inserts RS components 2 (optional) link M4 screws 3 M3 screws 2 Optic fibre holder (FCM ferrule clamp) Thorlabs 1 link Left handed MM33 micromanipulator M\u00e4rzh\u00e4user 1 link , datasheet","title":"Components"},{"location":"holders/components/#instrument-ring","text":"A ring-shaped instrument platform can be mounted around the sphere to hold several devices, such as an animal head-holder, cameras, and manipulators for electrical recording and optogenetic stimulation. Below we present options for head-clamps and holders for manipulating recording probes or optical fibres. Figure 1. Ring platform and head holding system","title":"Instrument ring"},{"location":"holders/components/#head-plate-holder","text":"We designed a head fixation system with three degrees of freedom. The height of the head-plate holder can be adjusted to accommodate mice of different sizes. In addition, two orthogonal axes are used in the horizontal plane to adjust the position of the animal's head. This is particularly useful for vestibular experiments to centre the platform rotation axis on the vestibular organ of interest. This head holding system is based on assembling 3 manual Thorlabs translational stages (MT1\\M) to ensure reliability and repeatability across experiments. The resolution of the system is 10 microns with a range of 13 mm in all directions. Figure 2. Virtual assembly of the head post (left) and real assembly (right). The materials needed for the assembly are: 3D printable parts (MT1/M linker, Head plate holder 1), the three MT1\\M translational stages, three MT405 side mounted actuator adapters, two M2.5 nuts, two hexagonal M2.5 screws, fifteen M6 screws (two of them optional) and two M6 threaded inserts (optional). Figure 3. Drawings of the MT1/M linker at 1:2 scale We also provide an MT1/M linker with a side-lip useable for attaching e.g. a camera or another instrument. An alternative Head-plate holder 2 is provided for attaching an MM33 manual micromanipulator.","title":"Head-plate holder"},{"location":"holders/components/#probe-holder-and-optic-fibre-holder","text":"A probe holder is provided for attaching e.g. a Neuronexus adaptor (Adpt-A32-OM32) to the MM33 micromanipulator for electrophysiological recordings. For optogenetic stimulation, an optic fibre can be secured to the MM33 micromanipulator using the Thorlabs FCM13/M ferrule clamp and a custom 3D printed adaptor. This allows the positioning of the light source at the desired location over the animal's head. Figure 6. Optical fiber holder","title":"Probe holder and optic fibre holder"},{"location":"holders/components/#bill-of-materials","text":"The 3D printed parts have been printed using a Form2 SLS 3D printer using the default settings with Clear V4 resin type. Component Manufacturer Units Reference Instrument ring 3D printed 1 STP file , STL files MT1/M linker 3D printed 1 STP file MT1/M linker with camera holder lip 3D printed 1 STP file , STL files Head-plate holder 1 3D printed 1 STP file Head-plate holder 2 (for MM33 manipulator) 3D printed 1 STP file , STL file Probe holder 3D printed 1 STP file Optic fiber holder 3D printed 1 STP file , STL file MT1/M translational stage Thorlabs 3 link MT405 side mounted actuator adapter Thorlabs 3 link RS6P/M posts Thorlabs 2 link M6 hex bold screws 16mm length RS components 15 (2 optional) link M2.5 hex bold screws RS components 4 link M2.5 nuts RS components 2 link M6 threaded inserts RS components 2 (optional) link M4 screws 3 M3 screws 2 Optic fibre holder (FCM ferrule clamp) Thorlabs 1 link Left handed MM33 micromanipulator M\u00e4rzh\u00e4user 1 link , datasheet","title":"Bill of materials"},{"location":"holders/headclamp/","text":"Headplate The design for the head-plate used with the clamp on the head-holder is shown in Figure 1. Figure 1. Head clamp drawings We have stimulated the performance of the head-plate using different materials (Aluminum, Titanium or Steel) and thicknesses (0.8 mm - 1 mm). The comparison can be performed knowing that the materials will be manufactured using the CNC technique from a block of homogeneous and isotropic material. The three materials simulated on the Solidworks simulation tool are: Aluminum 6061-T6 1 mm of thickness (0.3g). Titanium Grade 2 0.8 mm of thickness (0.41g). Stainless steel 316 0.8 mm of thickness (0.73g). The Initial conditions for the simulation are: A static load applied to the center ring (Blue arrows). Three axis fixture on the parts where the metric 2.5 screws are placed (green arrows). Figure 2. Head clamp simulations The results of maximum displacements obtained for each condition Aluminum max. displacement = 9.445e-04 mm Titanium max. displacement = 11.79e-04 mm Stainless Steel max. displacement = 6.443e-04 mm In conclusion, with the stainless steel head plate of 0.8 mm thickness, the displacement and strain of the head clamp is less than the Aluminum one (1 mm). Otherwise with the Titanium we lose stiffness with 0.8 mm thickness. Finally, the manufacturing supplier was 3D hubs and the chosen material: CNC machining / Stainless steel 316L / Smoothed (Ra 1.6\u03bcm, 63\u03bcin) The manufacturing files are available here and here .","title":"Head-plate"},{"location":"holders/headclamp/#headplate","text":"The design for the head-plate used with the clamp on the head-holder is shown in Figure 1. Figure 1. Head clamp drawings We have stimulated the performance of the head-plate using different materials (Aluminum, Titanium or Steel) and thicknesses (0.8 mm - 1 mm). The comparison can be performed knowing that the materials will be manufactured using the CNC technique from a block of homogeneous and isotropic material. The three materials simulated on the Solidworks simulation tool are: Aluminum 6061-T6 1 mm of thickness (0.3g). Titanium Grade 2 0.8 mm of thickness (0.41g). Stainless steel 316 0.8 mm of thickness (0.73g). The Initial conditions for the simulation are: A static load applied to the center ring (Blue arrows). Three axis fixture on the parts where the metric 2.5 screws are placed (green arrows). Figure 2. Head clamp simulations The results of maximum displacements obtained for each condition Aluminum max. displacement = 9.445e-04 mm Titanium max. displacement = 11.79e-04 mm Stainless Steel max. displacement = 6.443e-04 mm In conclusion, with the stainless steel head plate of 0.8 mm thickness, the displacement and strain of the head clamp is less than the Aluminum one (1 mm). Otherwise with the Titanium we lose stiffness with 0.8 mm thickness. Finally, the manufacturing supplier was 3D hubs and the chosen material: CNC machining / Stainless steel 316L / Smoothed (Ra 1.6\u03bcm, 63\u03bcin) The manufacturing files are available here and here .","title":"Headplate"},{"location":"platform/assembly/","text":"Assembly instructions Start assembling the Acrylic laser cut part \u201cBase\u201d with the Thorlabs RS05P pedestal posts and CF175 clamping forks using M6 screws. These posts are used to attach the rotary stage to the experimental table. Figure 1. Base assembly Use two M6 screws and nuts to attach the tube guide for the compressed air tube. Attach with M6 screws the two Thorlabs posts PH_50 and the TR_50 to the base. Figure 2. Rotary joint telescopic posts assembly The two Thorlabs PH_50 with the TR_50 are used to hold the rotary joint. To attach the rotary joint, you need two M6 or two M4 bolts with washers, depending on the position of the TR_50 (on one side is M4, on the other is M6). The compressed air tube can be installed now or at the end of the assembly. Figure 3. Rotary joint assembly Attach the seven Thorlabs RS150 posts to the base using M6 screws. Figure 4. Thorlabs RS150 assembly The animation below shows the order and location of components used for the base assembly. Base Assembly Once the rotary joint spacer is 3D printed, insert M3 brass threaded inserts and cure the part with UV light. Figure 5. Rotary joint spacer threaded inserts The Rotary Joint spacer is assembled with the rotary joint using 25 mm length M3 grab-screws. These are inserted using the radial holes on the bottom of the part. Figure 6. Rotary joint spacer assembly Figure 7. Rotary joint assembly The crossed roller bearing BRS RU124X must be assembled with Platform 2 using ten M5 bolts and M5 nuts. Figure 8. Crossed roller bearing assembled with the Platform 2 The manufacturer recommends the following installation order: Figure 9. Crossed roller bearing installation method (left) and Cross roller bearing installed (right) Warning On the laser cut part \u201cPlatform 2\u201d, it is recommended to drill chamfers for the M4 countersunk screws that will hold the motor. This step is important because the head of the screws has to be at the same level as the surface of Platform 2. Otherwise, they might touch the pulley or the belt. Figure 10. Detail of the countersink screws level with the surface Insert the four M4 screws with their nuts to fix the Nema 23 stepper motor to the Platform 2. Figure 11. Motor assembly The big pulley can be laser cut, as shown in Figure 12. It is composed by six layers of acrylic (2 x layer 1 in 5 mm thickness, 1 x layer 2 in 5 mm thickness, 2 x layer 2 in 3 mm thickness and 1 x layer 3 in 3 mm thickness). We recommend heating the threaded inserts with the soldering iron when inserting until they melt the plastic and go through the different layers. It is recommended to insert a couple using the external thread to get good alignment of the pulley teeth. Alternatively, there is an STL file to 3D print the pulley in one piece (this option has not been tested). Figure 12. Big pulley assembly (left) and threaded inserts (right) After laser cutting the circular platform, glue a small 5 mm Neodymium magnet as indicated in Figure 13. One of the magnet surfaces has to be coincident with the bottom surface of the platform. The magnet is there to interact with the Hall effect sensor at the bottom and trigger a state change to complete the homing position. Drilling chamfers on the outside holes for the countersunk screws, as seen in Figure 13, is also essential. Figure 13. Magnet glueing and chamfers Insert eight M6 screws to attach the Circular platform with the big pulley using the threaded inserts previously installed. Figure 14. Circular platform and big pulley assembly Assemble the Base with Platform 2 using 7 M6 screws. Figure 15. Base and Platform 2 assembly The animation below shows the order and location of components used for the platform assembly. Platform assembly Assemble the Hall Effect sensor used for the homing sequence, using two M3 screws, two Hall effect spacers and the Hall Effect holder. Figure 16. Hall Effect sensor assembly Figure 17. Hall effect sensor placement To assemble the circular platform, place the platform spacer on the inner ring of the bearing, then place the circular platform (assembled previously with the big pulley) on the spacer and use the M5 screws also installed as in the first step of the bearing (Figure 18). Figure 18. Circular platform assembly The animation below shows the order and location of components used for the big pulley assembly. Big pulley assembly Next, use the Thorlabs PH_50 and the TR_50 posts to adjust the height of the rotary joint spacer until it makes contact with the circular platform surface (Figure 19). Now you can insert six M4 screws to secure it. Figure 19. Adjustment of the Rotary joint height The shaft of the Motor is 8 mm in diameter, and the inner diameter of the small pulley is 6 mm. The inner diameter of the pulley has to be increased to 8 mm with a vertical drill or milling machine (Figure 20). Add a second hole with a 3.3 mm diameter (using a 3.3 mm drill bit) to add a fixing screw that prevents the pulley from rotating around the motor shaft. Thread the hole using an M4 tap toolkit. For this step, a vice is recommended to hold the pulley while drilling. To connect the encoder shaft with the pulley, the encoder attachment must be 3D printed, and two extra 2.5 mm holes must be drilled at the top of the pulley. Then, an M3 thread must be made using the M3 tap tool. Figure 20. Small pulley The pulley can be assembled before or after attaching the motor to platform 2. Figure 21. Small pulley and encoder The belt must envelop the small pulley when you put it on the motor shaft. You will feel a high tension when pulling the belt since it is rigid. Warning Remember to put the flat part of the motor shaft oriented in a comfortable position to secure with the small pulley M4 screw afterwards. Figure 22. Small pulley with motor shaft assembly Three M3 screws are used to attach the Encoder holder to the encoder. Figure 23. Encoder holder and encoder assembly Once the belt cover part is laser cut, four brass M4 threaded inserts must be inserted into the holes by heating them with the soldering iron or applying pressure. Figure 24. M4 threaded inserts on the belt cover Now four M4 screws can be inserted from the top placing the encoder spacers coincident with the holes. Figure 25. M4 threaded inserts on the belt cover The belt cover can now be installed using M6 screws, nuts and the cover spacers. After that, the encoder shaft must be in contact with the M4 grub screw at the top of the pulley. Figure 26. Belt cover assembly The animation below shows the order and location of components used for the small pulley assembly. Small pulley assembly To regulate the belt's tension, two ball bearings are inserted on the belt tensor, and one M6 screw is used to install it in the guide. Use four washers to get a good fit on the inside and outside of the screw with the two sides of the belt cover and Platform 2. Figure 27. Belt tensor assembly Figure 28. Detail of the two ball bearings Now adjust the tension of the belt. Check the belt is not touching the bottom or the top surfaces. Figure 29. Space on both sides of the belt The vertical tubing for compressed air can now be inserted through the rotary joint through-hole into the pneumatic tube elbow. Lastly, the sphere holder has to be attached with four M6 screws. Figure 30-31. Sphere holder assembly Figure 32. Complete assembly","title":"Assembly"},{"location":"platform/assembly/#assembly-instructions","text":"Start assembling the Acrylic laser cut part \u201cBase\u201d with the Thorlabs RS05P pedestal posts and CF175 clamping forks using M6 screws. These posts are used to attach the rotary stage to the experimental table. Figure 1. Base assembly Use two M6 screws and nuts to attach the tube guide for the compressed air tube. Attach with M6 screws the two Thorlabs posts PH_50 and the TR_50 to the base. Figure 2. Rotary joint telescopic posts assembly The two Thorlabs PH_50 with the TR_50 are used to hold the rotary joint. To attach the rotary joint, you need two M6 or two M4 bolts with washers, depending on the position of the TR_50 (on one side is M4, on the other is M6). The compressed air tube can be installed now or at the end of the assembly. Figure 3. Rotary joint assembly Attach the seven Thorlabs RS150 posts to the base using M6 screws. Figure 4. Thorlabs RS150 assembly The animation below shows the order and location of components used for the base assembly. Base Assembly Once the rotary joint spacer is 3D printed, insert M3 brass threaded inserts and cure the part with UV light. Figure 5. Rotary joint spacer threaded inserts The Rotary Joint spacer is assembled with the rotary joint using 25 mm length M3 grab-screws. These are inserted using the radial holes on the bottom of the part. Figure 6. Rotary joint spacer assembly Figure 7. Rotary joint assembly The crossed roller bearing BRS RU124X must be assembled with Platform 2 using ten M5 bolts and M5 nuts. Figure 8. Crossed roller bearing assembled with the Platform 2 The manufacturer recommends the following installation order: Figure 9. Crossed roller bearing installation method (left) and Cross roller bearing installed (right) Warning On the laser cut part \u201cPlatform 2\u201d, it is recommended to drill chamfers for the M4 countersunk screws that will hold the motor. This step is important because the head of the screws has to be at the same level as the surface of Platform 2. Otherwise, they might touch the pulley or the belt. Figure 10. Detail of the countersink screws level with the surface Insert the four M4 screws with their nuts to fix the Nema 23 stepper motor to the Platform 2. Figure 11. Motor assembly The big pulley can be laser cut, as shown in Figure 12. It is composed by six layers of acrylic (2 x layer 1 in 5 mm thickness, 1 x layer 2 in 5 mm thickness, 2 x layer 2 in 3 mm thickness and 1 x layer 3 in 3 mm thickness). We recommend heating the threaded inserts with the soldering iron when inserting until they melt the plastic and go through the different layers. It is recommended to insert a couple using the external thread to get good alignment of the pulley teeth. Alternatively, there is an STL file to 3D print the pulley in one piece (this option has not been tested). Figure 12. Big pulley assembly (left) and threaded inserts (right) After laser cutting the circular platform, glue a small 5 mm Neodymium magnet as indicated in Figure 13. One of the magnet surfaces has to be coincident with the bottom surface of the platform. The magnet is there to interact with the Hall effect sensor at the bottom and trigger a state change to complete the homing position. Drilling chamfers on the outside holes for the countersunk screws, as seen in Figure 13, is also essential. Figure 13. Magnet glueing and chamfers Insert eight M6 screws to attach the Circular platform with the big pulley using the threaded inserts previously installed. Figure 14. Circular platform and big pulley assembly Assemble the Base with Platform 2 using 7 M6 screws. Figure 15. Base and Platform 2 assembly The animation below shows the order and location of components used for the platform assembly. Platform assembly Assemble the Hall Effect sensor used for the homing sequence, using two M3 screws, two Hall effect spacers and the Hall Effect holder. Figure 16. Hall Effect sensor assembly Figure 17. Hall effect sensor placement To assemble the circular platform, place the platform spacer on the inner ring of the bearing, then place the circular platform (assembled previously with the big pulley) on the spacer and use the M5 screws also installed as in the first step of the bearing (Figure 18). Figure 18. Circular platform assembly The animation below shows the order and location of components used for the big pulley assembly. Big pulley assembly Next, use the Thorlabs PH_50 and the TR_50 posts to adjust the height of the rotary joint spacer until it makes contact with the circular platform surface (Figure 19). Now you can insert six M4 screws to secure it. Figure 19. Adjustment of the Rotary joint height The shaft of the Motor is 8 mm in diameter, and the inner diameter of the small pulley is 6 mm. The inner diameter of the pulley has to be increased to 8 mm with a vertical drill or milling machine (Figure 20). Add a second hole with a 3.3 mm diameter (using a 3.3 mm drill bit) to add a fixing screw that prevents the pulley from rotating around the motor shaft. Thread the hole using an M4 tap toolkit. For this step, a vice is recommended to hold the pulley while drilling. To connect the encoder shaft with the pulley, the encoder attachment must be 3D printed, and two extra 2.5 mm holes must be drilled at the top of the pulley. Then, an M3 thread must be made using the M3 tap tool. Figure 20. Small pulley The pulley can be assembled before or after attaching the motor to platform 2. Figure 21. Small pulley and encoder The belt must envelop the small pulley when you put it on the motor shaft. You will feel a high tension when pulling the belt since it is rigid. Warning Remember to put the flat part of the motor shaft oriented in a comfortable position to secure with the small pulley M4 screw afterwards. Figure 22. Small pulley with motor shaft assembly Three M3 screws are used to attach the Encoder holder to the encoder. Figure 23. Encoder holder and encoder assembly Once the belt cover part is laser cut, four brass M4 threaded inserts must be inserted into the holes by heating them with the soldering iron or applying pressure. Figure 24. M4 threaded inserts on the belt cover Now four M4 screws can be inserted from the top placing the encoder spacers coincident with the holes. Figure 25. M4 threaded inserts on the belt cover The belt cover can now be installed using M6 screws, nuts and the cover spacers. After that, the encoder shaft must be in contact with the M4 grub screw at the top of the pulley. Figure 26. Belt cover assembly The animation below shows the order and location of components used for the small pulley assembly. Small pulley assembly To regulate the belt's tension, two ball bearings are inserted on the belt tensor, and one M6 screw is used to install it in the guide. Use four washers to get a good fit on the inside and outside of the screw with the two sides of the belt cover and Platform 2. Figure 27. Belt tensor assembly Figure 28. Detail of the two ball bearings Now adjust the tension of the belt. Check the belt is not touching the bottom or the top surfaces. Figure 29. Space on both sides of the belt The vertical tubing for compressed air can now be inserted through the rotary joint through-hole into the pneumatic tube elbow. Lastly, the sphere holder has to be attached with four M6 screws. Figure 30-31. Sphere holder assembly Figure 32. Complete assembly","title":"Assembly instructions"},{"location":"platform/components/","text":"Main components Rotary joint A rotary joint enables electrical communications between the base and the rotating platform. It has a through-hole design for routing the compressed air tube. The selected model is the Senring UH1256-02-0610-06S, of the UH1256-02 Series. It has two USB ports that can be used to connect, e.g. cameras, and several power and data wires to connect different sensors and other accessories. Figure 1. Senring UH1256-02-0610-06S Series Crossed roller bearing The crossed roller bearing provides a stable joint between the fixed base and the rotation platform. A suitable model for the application is the BRS RU124X considering fitting the rotary joint (inner diameter > 55mm). This bearing provides strong joint stability against axial and radial forces as well as torque due to its best-in-class axial runout (2-5 \u00b5m). Figure 2. SBRS RU124X Crossed roller bearing DC motor and driver To approximate the motor requirements, we have estimated the moment of inertia around the vertical axis. For this approximation, we have considered two main components: the circular platform and all the elements on the platform and the inner ring of the crossed roller bearing. To simplify the approximation, the internal ring of the bearing has been considered as a stainless steel solid part. The negligible friction force of the bearing has not been taken into account. Both moments of inertia have been extracted using the mass properties of the Solidworks\u00ae CAD software. With this value, we can make the approximation of the torque needed to accelerate the system using Newton\u2019s 2nd law of rotation : . After numerical simulation, we can obtain a theoretical maximum acceleration, useful to choose the motor, described by the function : With this relationship, we can estimate the maximum torque needed for the motor. The theoretical maximum angular acceleration is 1100 \u00b0/s^2 with a 3 Nm motor option. A stepper motor was selected accordingly: Nema 23 Stepper Motor 3 Nm 4.2A with a DM542A driver. Figure 3. Nema 23 stepper motor and DM542A stepper driver Nema 23 Stepper motor main features: Property value steps/rev 200 L (mH) 3.2 I max (A) 4.2 V (V) 24 T (N.m) 3 P max (W) 96 The current can be selected using the first four switches of the driver DIP switch: The driver also has a DIP switch to select the desired micro-stepping mode: Belt selection We have adjusted the number of teeth of the big and the small pulley to get a gear ratio of 6:1 considering the minimum diameter of the big pulley as the outside diameter of the crossed roller bearing BRS RU124X. The diameter of the small (commercially available) pulley with = 36 teeth is 34.38 mm. Once the big and small pulley diameters ( D and d ) have been defined, the distance between centers ( C ) is calculated to get the desired length L : The number of teeth obtained for the big pulley is 216, and the distance between centers is 260 mm. These results determined the choice of the belt for our device. The timing belt The size of the belt was calculated considering the outside diameter of the crossed roller bearing (OD > 165 mm) and the desired gear ratio of 1:6, which provides the stage of a maximum theoretical value of 12 Nm. To calculate the belt parameters, first, we consider the maximum width of the belt for our space constraints, which is 20 mm. According to the distance between centers and the pulley diameters, the required belt length is 927 mm, and the chosen belt width is 15 mm. Figure 6. Timing belt The small pulley The pulley driven by the Nema 23 stepper motor is a 36 teeth HTD3 metal pulley provided by RS Components. Figure 7. Small pulley Bill of materials 3D printing was done using FormLabs Clear V4 resin. PMMA (10 mm thickness) was used for all laser-cut parts unless otherwise indicated. Component Quantity Supplier Reference Resin for 3D printing Plastic for laser cutting Base 1 Laser cut STEP file Platform 2 (Rev1) 1 Laser cut STEP file Belt cover (Rev1) 1 Laser cut STEP file Circular platform 1 Laser cut STEP file Platform spacer 1 Laser cut STEP file Hall-effect sensor spacer 2 3D printed STEP file Hall-effect sensor holder 1 3D printed STEP file Big pulley (option 1) 2 Laser cut dxf file, layer 1, 5mm thickness 1 Laser cut dxf file, layer 2, 5mm thickness 2 Laser cut dxf file, layer 2, 3mm thickness 1 Laser cut dxf file, layer 3, 3mm thickness Big pulley (option 2, Rev1) 3D printed STEP file , STL file Belt tensor 1 3D printed STEP file Encoder holder 1 Laser cut STEP file, 5mm thickness Encoder spacer 4 Laser cut / 3D printed STEP file, 5mm thickness Encoder attachment 1 3D printed STEP file , STL file Cover spacer 6 3D printed STEP file Tube guide 1 3D printed STEP file Rotary joint spacer 1 3D printed STEP file Sphere holder 1 3D printed STL file Small pulley (Rev1) 1 RS Components link Belt 1 Ebay link CF175 4 Thorlabs link RS05P 4 Thorlabs link RS150 7 Thorlabs link TR_50M 2 Thorlabs link PH_50 2 Thorlabs link M6 washers 2 Thorlabs link M6 screws 44 Thorlabs link M5 screws 24 Thorlabs link M4 screws 11 Thorlabs link M3 screws 7 Thorlabs link M3 grub screw (25mm) Amazon link M6 nuts 9 Thorlabs link M5 nuts 14 Thorlabs link BRS RU124X bearing 1 BRS link Rotary Joint 1 Senring link Encoder 1 Amazon link Hall effect sensor 1 Amazon link Magnet 1 RS Components link Nema 23 motor & driver 1 Ebay link M6 threaded insert RS Components link M4 threaded insert RS Components link M3 threaded insert RS Components link Bearings 2 RS Components link Pneumatic tube 1 Amazon link Pneumatic tube joint 1 Amazon link Datasheets and documents Component Reference BRS RU124X bearing Datasheet Inspection Report Nema 23 motor & driver Datasheet Rotary joint Datasheet","title":"Components"},{"location":"platform/components/#main-components","text":"","title":"Main components"},{"location":"platform/components/#rotary-joint","text":"A rotary joint enables electrical communications between the base and the rotating platform. It has a through-hole design for routing the compressed air tube. The selected model is the Senring UH1256-02-0610-06S, of the UH1256-02 Series. It has two USB ports that can be used to connect, e.g. cameras, and several power and data wires to connect different sensors and other accessories. Figure 1. Senring UH1256-02-0610-06S Series","title":"Rotary joint"},{"location":"platform/components/#crossed-roller-bearing","text":"The crossed roller bearing provides a stable joint between the fixed base and the rotation platform. A suitable model for the application is the BRS RU124X considering fitting the rotary joint (inner diameter > 55mm). This bearing provides strong joint stability against axial and radial forces as well as torque due to its best-in-class axial runout (2-5 \u00b5m). Figure 2. SBRS RU124X Crossed roller bearing","title":"Crossed roller bearing"},{"location":"platform/components/#dc-motor-and-driver","text":"To approximate the motor requirements, we have estimated the moment of inertia around the vertical axis. For this approximation, we have considered two main components: the circular platform and all the elements on the platform and the inner ring of the crossed roller bearing. To simplify the approximation, the internal ring of the bearing has been considered as a stainless steel solid part. The negligible friction force of the bearing has not been taken into account. Both moments of inertia have been extracted using the mass properties of the Solidworks\u00ae CAD software. With this value, we can make the approximation of the torque needed to accelerate the system using Newton\u2019s 2nd law of rotation : . After numerical simulation, we can obtain a theoretical maximum acceleration, useful to choose the motor, described by the function : With this relationship, we can estimate the maximum torque needed for the motor. The theoretical maximum angular acceleration is 1100 \u00b0/s^2 with a 3 Nm motor option. A stepper motor was selected accordingly: Nema 23 Stepper Motor 3 Nm 4.2A with a DM542A driver. Figure 3. Nema 23 stepper motor and DM542A stepper driver Nema 23 Stepper motor main features: Property value steps/rev 200 L (mH) 3.2 I max (A) 4.2 V (V) 24 T (N.m) 3 P max (W) 96 The current can be selected using the first four switches of the driver DIP switch: The driver also has a DIP switch to select the desired micro-stepping mode:","title":"DC motor and driver"},{"location":"platform/components/#belt-selection","text":"We have adjusted the number of teeth of the big and the small pulley to get a gear ratio of 6:1 considering the minimum diameter of the big pulley as the outside diameter of the crossed roller bearing BRS RU124X. The diameter of the small (commercially available) pulley with = 36 teeth is 34.38 mm. Once the big and small pulley diameters ( D and d ) have been defined, the distance between centers ( C ) is calculated to get the desired length L : The number of teeth obtained for the big pulley is 216, and the distance between centers is 260 mm. These results determined the choice of the belt for our device.","title":"Belt selection"},{"location":"platform/components/#the-timing-belt","text":"The size of the belt was calculated considering the outside diameter of the crossed roller bearing (OD > 165 mm) and the desired gear ratio of 1:6, which provides the stage of a maximum theoretical value of 12 Nm. To calculate the belt parameters, first, we consider the maximum width of the belt for our space constraints, which is 20 mm. According to the distance between centers and the pulley diameters, the required belt length is 927 mm, and the chosen belt width is 15 mm. Figure 6. Timing belt","title":"The timing belt"},{"location":"platform/components/#the-small-pulley","text":"The pulley driven by the Nema 23 stepper motor is a 36 teeth HTD3 metal pulley provided by RS Components. Figure 7. Small pulley","title":"The small pulley"},{"location":"platform/components/#bill-of-materials","text":"3D printing was done using FormLabs Clear V4 resin. PMMA (10 mm thickness) was used for all laser-cut parts unless otherwise indicated. Component Quantity Supplier Reference Resin for 3D printing Plastic for laser cutting Base 1 Laser cut STEP file Platform 2 (Rev1) 1 Laser cut STEP file Belt cover (Rev1) 1 Laser cut STEP file Circular platform 1 Laser cut STEP file Platform spacer 1 Laser cut STEP file Hall-effect sensor spacer 2 3D printed STEP file Hall-effect sensor holder 1 3D printed STEP file Big pulley (option 1) 2 Laser cut dxf file, layer 1, 5mm thickness 1 Laser cut dxf file, layer 2, 5mm thickness 2 Laser cut dxf file, layer 2, 3mm thickness 1 Laser cut dxf file, layer 3, 3mm thickness Big pulley (option 2, Rev1) 3D printed STEP file , STL file Belt tensor 1 3D printed STEP file Encoder holder 1 Laser cut STEP file, 5mm thickness Encoder spacer 4 Laser cut / 3D printed STEP file, 5mm thickness Encoder attachment 1 3D printed STEP file , STL file Cover spacer 6 3D printed STEP file Tube guide 1 3D printed STEP file Rotary joint spacer 1 3D printed STEP file Sphere holder 1 3D printed STL file Small pulley (Rev1) 1 RS Components link Belt 1 Ebay link CF175 4 Thorlabs link RS05P 4 Thorlabs link RS150 7 Thorlabs link TR_50M 2 Thorlabs link PH_50 2 Thorlabs link M6 washers 2 Thorlabs link M6 screws 44 Thorlabs link M5 screws 24 Thorlabs link M4 screws 11 Thorlabs link M3 screws 7 Thorlabs link M3 grub screw (25mm) Amazon link M6 nuts 9 Thorlabs link M5 nuts 14 Thorlabs link BRS RU124X bearing 1 BRS link Rotary Joint 1 Senring link Encoder 1 Amazon link Hall effect sensor 1 Amazon link Magnet 1 RS Components link Nema 23 motor & driver 1 Ebay link M6 threaded insert RS Components link M4 threaded insert RS Components link M3 threaded insert RS Components link Bearings 2 RS Components link Pneumatic tube 1 Amazon link Pneumatic tube joint 1 Amazon link","title":"Bill of materials"},{"location":"platform/components/#datasheets-and-documents","text":"Component Reference BRS RU124X bearing Datasheet Inspection Report Nema 23 motor & driver Datasheet Rotary joint Datasheet","title":"Datasheets and documents"},{"location":"pupil/assembly/","text":"Assembly instructions Cut 2 pieces of silicone tube to similar lengths as the mirror edges (36 mm and 25 mm). Glue both parts into the mirror holder. Use a scalpel to make a longitudinal cut along both tubes. Insert a 6 mm diameter Thorlabs post into the mirror holder. Figure 1. Mirror holder assembly Use a 3D printing material with opaque features (e.g. FormLabs black resin). If using clear resin, use black matt spray to block out external light. Use 4 M2 screws and nuts to attach the camera to the camera holder. Insert the filter, mounted on a CP35/M and an SM1L03 lens tube in the filter holder. Use 4 M3 screws to attach it to the filter holder cover. Use two long (25-30 mm) M3 screws as shafts to open and close the filter holder. Figure 2. Camera and filter holder assembly Use an M6 screw and nut to attach the camera holder to the MT1/M linker with the camera holder lip found in the \"Instrument ring and head holder\" section. Figure 3. Camera assembly to head-fixation system Attach the mirror holder to the instrument ring or the rotation platform using Thorlabs components (e.g. RA90TR/M and 12.7 mm post). Mount the head fixation system onto the instrument ring. Figure 4. Camera and mirror","title":"Assembly"},{"location":"pupil/assembly/#assembly-instructions","text":"Cut 2 pieces of silicone tube to similar lengths as the mirror edges (36 mm and 25 mm). Glue both parts into the mirror holder. Use a scalpel to make a longitudinal cut along both tubes. Insert a 6 mm diameter Thorlabs post into the mirror holder. Figure 1. Mirror holder assembly Use a 3D printing material with opaque features (e.g. FormLabs black resin). If using clear resin, use black matt spray to block out external light. Use 4 M2 screws and nuts to attach the camera to the camera holder. Insert the filter, mounted on a CP35/M and an SM1L03 lens tube in the filter holder. Use 4 M3 screws to attach it to the filter holder cover. Use two long (25-30 mm) M3 screws as shafts to open and close the filter holder. Figure 2. Camera and filter holder assembly Use an M6 screw and nut to attach the camera holder to the MT1/M linker with the camera holder lip found in the \"Instrument ring and head holder\" section. Figure 3. Camera assembly to head-fixation system Attach the mirror holder to the instrument ring or the rotation platform using Thorlabs components (e.g. RA90TR/M and 12.7 mm post). Mount the head fixation system onto the instrument ring. Figure 4. Camera and mirror","title":"Assembly instructions"},{"location":"pupil/components/","text":"Camera-mirror complex for pupil tracking A camera can be added to the ring-shaped instrument platform to record e.g. eye or facial movements. We chose a web camera with a small footprint, low weight and USB connectivity through the rotary joint. It lacks an IR filter. We used an IR LED for illumination and a Thorlabs FEL0750 - \u00d81\" long pass filter mounted on a CP35/M - 30 mm cage Plate using an SM1L03 lens tube. The image of the animal is reflected on an FM02R red hot mirror ((25 mm x 36 mm) with an incidence angle of 45\u00b0. The mirror position can be adjusted with Thorlabs post elements, and the camera can be rotated and translated for adequate positioning. Figure 1. Camera with hot mirror Bill of materials Component Quantity Supplier Reference Mirror holder 1 3D printed STP file , STL file Camera holder 1 3D printed STP file , STL file Filter holder 1 3D printed STP file , STL file Filter holder cover 1 3D printed STP file , STL file M2 screw 4 - - M3 screw 6 - - M2 nuts 4 - - M6 screw 1 - - M6 nut 1 - - FEL0750 - \u00d81\" Long pass Filter 1 Thorlabs link CP35/M - 30 mm Cage Plate 1 Thorlabs link SM1L03 - SM1 Lens Tube 1 Thorlabs link FM02R - 25 mm x 36 mm Red Hot Mirror 1 Thorlabs link ELP webcam 1 Amazon link","title":"Components"},{"location":"pupil/components/#camera-mirror-complex-for-pupil-tracking","text":"A camera can be added to the ring-shaped instrument platform to record e.g. eye or facial movements. We chose a web camera with a small footprint, low weight and USB connectivity through the rotary joint. It lacks an IR filter. We used an IR LED for illumination and a Thorlabs FEL0750 - \u00d81\" long pass filter mounted on a CP35/M - 30 mm cage Plate using an SM1L03 lens tube. The image of the animal is reflected on an FM02R red hot mirror ((25 mm x 36 mm) with an incidence angle of 45\u00b0. The mirror position can be adjusted with Thorlabs post elements, and the camera can be rotated and translated for adequate positioning. Figure 1. Camera with hot mirror","title":"Camera-mirror complex for pupil tracking"},{"location":"pupil/components/#bill-of-materials","text":"Component Quantity Supplier Reference Mirror holder 1 3D printed STP file , STL file Camera holder 1 3D printed STP file , STL file Filter holder 1 3D printed STP file , STL file Filter holder cover 1 3D printed STP file , STL file M2 screw 4 - - M3 screw 6 - - M2 nuts 4 - - M6 screw 1 - - M6 nut 1 - - FEL0750 - \u00d81\" Long pass Filter 1 Thorlabs link CP35/M - 30 mm Cage Plate 1 Thorlabs link SM1L03 - SM1 Lens Tube 1 Thorlabs link FM02R - 25 mm x 36 mm Red Hot Mirror 1 Thorlabs link ELP webcam 1 Amazon link","title":"Bill of materials"},{"location":"screens/VR/","text":"Raspberry Pi The VR environment runs on a Raspberry Pi 4 Modell B located on the platform, running Raspbian 10 (Buster). The Pi is connected to the screens via micro HDMI cables. The Raspberry Pi is powered through one of the USB cables on the slip ring, using a USB to USB-C adaptor. The Teensy USB port is directly connected to one of the USB ports of the Raspberry Pi. Connections are indicated below Figure 1. Connections to Raspberri Pi4 Sensor input through USB The optical sensor inputs transformed on the Teensy to calculate the motor displacement are converted using the Mouse HID Library included in Teensyduino, and transmitted to the Raspberry Pi via USB using the Mouse.move(x, y) function. The Teensy USB port should be set up as a HID + Serial (select the USB mode in Tools -> USB type -> Serial + Keyboard + mouse + joystick when uploading the code using Arduino IDE). Godot Compilation instructions Godot 3.2 is compiled from source using clang. After installing clang and any required libraries (see here ), clone and install Godot using the commands below: git clone https://github.com/godotengine/godot cd godot git checkout 3.2-stable scons platform=x11 target=release_debug tools=yes use_llvm=yes CCFLAGS=\"-mtune=cortex-a72 -mcpu=cortex-a72 -mfloat-abi=hard -mfpu=neon-fp-armv8\" -j4 sudo cp bin/godot.x11.opt.tools.32.llvm /usr/bin/godo Environment The 3D environment is created in Godot. The camera position is updated using a script written in GDScript, relative to the movements of the emulated mouse carrying the optical sensor input. The game is run via a bash script that ensures the game is running in full-screen mode across the two monitors. The (x,y) coordinates of the player within the environment are automatically saved in a csv file. The virtual corridor is available to download here The video linked here shows a proof-of-principle experiment, where an untrained mouse in navigating on the setup. At the top, a camera behind (and to the right of) the mouse shows the snout, whiskers and the screens. At the bottom, a camera above the setup shows the mouse, the styrofoam ball and the top edge of the screens (helpful to see the physical rotation). The red line in the bottom right shows the trajectory of the animal in VR space.","title":"Virtual Reality"},{"location":"screens/VR/#raspberry-pi","text":"The VR environment runs on a Raspberry Pi 4 Modell B located on the platform, running Raspbian 10 (Buster). The Pi is connected to the screens via micro HDMI cables. The Raspberry Pi is powered through one of the USB cables on the slip ring, using a USB to USB-C adaptor. The Teensy USB port is directly connected to one of the USB ports of the Raspberry Pi. Connections are indicated below Figure 1. Connections to Raspberri Pi4","title":"Raspberry Pi"},{"location":"screens/VR/#sensor-input-through-usb","text":"The optical sensor inputs transformed on the Teensy to calculate the motor displacement are converted using the Mouse HID Library included in Teensyduino, and transmitted to the Raspberry Pi via USB using the Mouse.move(x, y) function. The Teensy USB port should be set up as a HID + Serial (select the USB mode in Tools -> USB type -> Serial + Keyboard + mouse + joystick when uploading the code using Arduino IDE).","title":"Sensor input through USB"},{"location":"screens/VR/#godot","text":"","title":"Godot"},{"location":"screens/VR/#compilation-instructions","text":"Godot 3.2 is compiled from source using clang. After installing clang and any required libraries (see here ), clone and install Godot using the commands below: git clone https://github.com/godotengine/godot cd godot git checkout 3.2-stable scons platform=x11 target=release_debug tools=yes use_llvm=yes CCFLAGS=\"-mtune=cortex-a72 -mcpu=cortex-a72 -mfloat-abi=hard -mfpu=neon-fp-armv8\" -j4 sudo cp bin/godot.x11.opt.tools.32.llvm /usr/bin/godo","title":"Compilation instructions"},{"location":"screens/VR/#environment","text":"The 3D environment is created in Godot. The camera position is updated using a script written in GDScript, relative to the movements of the emulated mouse carrying the optical sensor input. The game is run via a bash script that ensures the game is running in full-screen mode across the two monitors. The (x,y) coordinates of the player within the environment are automatically saved in a csv file. The virtual corridor is available to download here The video linked here shows a proof-of-principle experiment, where an untrained mouse in navigating on the setup. At the top, a camera behind (and to the right of) the mouse shows the snout, whiskers and the screens. At the bottom, a camera above the setup shows the mouse, the styrofoam ball and the top edge of the screens (helpful to see the physical rotation). The red line in the bottom right shows the trajectory of the animal in VR space.","title":"Environment"},{"location":"screens/assembly/","text":"Assembly instructions To assemble the screen, the display and the front and back screen holders need to be attached using spacers, M4 screws and nuts. Figure 1. Screen assembly Separately assemble the 3D printed Screen attachment 1 with the back of the Screen holder. Figure 2. Front holder assembly Attach the electronic board with the screen holder back using 3 M3 screws and nuts. Then attach the two back holders with M4 screws. Figure 3. Back holder assembly Figure 4. Location of the screens on the platform","title":"Assembly"},{"location":"screens/assembly/#assembly-instructions","text":"To assemble the screen, the display and the front and back screen holders need to be attached using spacers, M4 screws and nuts. Figure 1. Screen assembly Separately assemble the 3D printed Screen attachment 1 with the back of the Screen holder. Figure 2. Front holder assembly Attach the electronic board with the screen holder back using 3 M3 screws and nuts. Then attach the two back holders with M4 screws. Figure 3. Back holder assembly Figure 4. Location of the screens on the platform","title":"Assembly instructions"},{"location":"screens/components/","text":"Components Two 8\u201d SKD819VAHT-9 TFT displays are attached to the rotary platform using two Thorlabs RS6P_M posts. The displays are attached to the posts with a 3D printed part (Screen attachment 1). The display frame comprises three laser-cut acrylic parts and some laser-cut spacers. Eight M4 screws and nuts are required to build the acrylic structure, and an M6 screw is required to attach the 3D printed attachment with the Thorlabs post. Bill of materials (per screen) Component Quantity Supplier Reference SKD819VAHT-9 TFT screens 1 - link Screen holder front 1 Laser cut STP file , DXF file Screen holder back 1 Laser cut STP file , DXF file Screen holder back 2 1 Laser cut STP file , DXF file Screen attachment 1 1 3D printed STP file , STL file Spacer 4 3D printed STP file , STL file Spacer 2 4 3D printed STP file , STL file RS6P/M 1 Thorlabs link M4 screw 8 RS Components link M4 nut 4 RS Components link M6 screw 1 RS Components link","title":"Components"},{"location":"screens/components/#components","text":"Two 8\u201d SKD819VAHT-9 TFT displays are attached to the rotary platform using two Thorlabs RS6P_M posts. The displays are attached to the posts with a 3D printed part (Screen attachment 1). The display frame comprises three laser-cut acrylic parts and some laser-cut spacers. Eight M4 screws and nuts are required to build the acrylic structure, and an M6 screw is required to attach the 3D printed attachment with the Thorlabs post.","title":"Components"},{"location":"screens/components/#bill-of-materials-per-screen","text":"Component Quantity Supplier Reference SKD819VAHT-9 TFT screens 1 - link Screen holder front 1 Laser cut STP file , DXF file Screen holder back 1 Laser cut STP file , DXF file Screen holder back 2 1 Laser cut STP file , DXF file Screen attachment 1 1 3D printed STP file , STL file Spacer 4 3D printed STP file , STL file Spacer 2 4 3D printed STP file , STL file RS6P/M 1 Thorlabs link M4 screw 8 RS Components link M4 nut 4 RS Components link M6 screw 1 RS Components link","title":"Bill of materials (per screen)"},{"location":"sensors/assembly/","text":"Assembly instructions The PCB must be removed from the optical mouse first. Then the VDD, GND, SCK and SDIO pins must be soldered to wires leading to the microcontroller and its internal 5V power supply. Figure 1. Soldered pins on the ADNS-2610 Insert the two M3 brass threaded inserts into the sensor holder by applying pressure. Attach the sensor to the sensor holder using 2 M3 screws. Figure 2 Optical sensor assembly Then follow the instructions in Figure 3 to assemble the three Thorlabs components with the sensor holder. Figure 3. Optical sensor assembly The lens must be glued to the PCB in the correct position, with the lens aligned with the optical flow sensor. Figure 4. ADNS-2610 glued with the lens Attach the whole assembly on the rotary stage platform (e.g. at 0 or 90 degrees to the animal's anteroposterior axis). Figure 5. Optical sensor \u2013 platform assembly Connect the pins on the PCB 5V, GND, and two digital pins as shown on the \"electrical setup and configuration\" page.","title":"Assembly"},{"location":"sensors/assembly/#assembly-instructions","text":"The PCB must be removed from the optical mouse first. Then the VDD, GND, SCK and SDIO pins must be soldered to wires leading to the microcontroller and its internal 5V power supply. Figure 1. Soldered pins on the ADNS-2610 Insert the two M3 brass threaded inserts into the sensor holder by applying pressure. Attach the sensor to the sensor holder using 2 M3 screws. Figure 2 Optical sensor assembly Then follow the instructions in Figure 3 to assemble the three Thorlabs components with the sensor holder. Figure 3. Optical sensor assembly The lens must be glued to the PCB in the correct position, with the lens aligned with the optical flow sensor. Figure 4. ADNS-2610 glued with the lens Attach the whole assembly on the rotary stage platform (e.g. at 0 or 90 degrees to the animal's anteroposterior axis). Figure 5. Optical sensor \u2013 platform assembly Connect the pins on the PCB 5V, GND, and two digital pins as shown on the \"electrical setup and configuration\" page.","title":"Assembly instructions"},{"location":"sensors/characterization/","text":"Sensor characterization The library to interface with the sensors is available on GitHub [1] . It provides access to the SQUAL register, which gives the reading of how good is the surface pattern to detect xy displacements. Figure 1 shows the measurement error vs the SQUAL value for one revolution of the sphere. The maximum SQUAL value was 120 (0 means no surface detection). Figure 1. Relationship between the measurement error and the SQUAL value Characterization The characterization of the ADNS2610 optical sensors was performed by collecting 30 revolutions of the polystyrene sphere. The number of the optical sensor internal units per revolution was 9391 on average. The polystyrene sphere has a perimeter of 61.86 cm, thus, the number of sensor internal units per cm equals 151.81. SQUAL values were recorded simultaneously (average 82.56 \u00b1 23.92). Figure 2 (left) shows the distribution of the SQUAL values. Figure 2 (right) shows the relationship between the rotation speed as the increment in sensor internal units between two samples and the SQUAL value. Figure 2. Distribution of the SQUAL values (left). Speed vs SQUAL value relationship (right) Adjustments The vertical and horizontal positions of the sensor should be adjusted. The vertical position can be adjusted by the Thorlab post for the sensor to match the sphere's equator. Then the horizontal position can be optimized by adjusting the sensor holder until a SQUAL value higher than 100 has been achieved. Data The data and code used for the sensor validation are available here . References [1] https://github.com/zapmaker/OptiMouse","title":"Characterization"},{"location":"sensors/characterization/#sensor-characterization","text":"The library to interface with the sensors is available on GitHub [1] . It provides access to the SQUAL register, which gives the reading of how good is the surface pattern to detect xy displacements. Figure 1 shows the measurement error vs the SQUAL value for one revolution of the sphere. The maximum SQUAL value was 120 (0 means no surface detection). Figure 1. Relationship between the measurement error and the SQUAL value","title":"Sensor characterization"},{"location":"sensors/characterization/#characterization","text":"The characterization of the ADNS2610 optical sensors was performed by collecting 30 revolutions of the polystyrene sphere. The number of the optical sensor internal units per revolution was 9391 on average. The polystyrene sphere has a perimeter of 61.86 cm, thus, the number of sensor internal units per cm equals 151.81. SQUAL values were recorded simultaneously (average 82.56 \u00b1 23.92). Figure 2 (left) shows the distribution of the SQUAL values. Figure 2 (right) shows the relationship between the rotation speed as the increment in sensor internal units between two samples and the SQUAL value. Figure 2. Distribution of the SQUAL values (left). Speed vs SQUAL value relationship (right)","title":"Characterization"},{"location":"sensors/characterization/#adjustments","text":"The vertical and horizontal positions of the sensor should be adjusted. The vertical position can be adjusted by the Thorlab post for the sensor to match the sphere's equator. Then the horizontal position can be optimized by adjusting the sensor holder until a SQUAL value higher than 100 has been achieved.","title":"Adjustments"},{"location":"sensors/characterization/#data","text":"The data and code used for the sensor validation are available here .","title":"Data"},{"location":"sensors/characterization/#references","text":"[1] https://github.com/zapmaker/OptiMouse","title":"References"},{"location":"sensors/components/","text":"Optical motion sensors Sensors To measure the position of the sphere, we used two PCB boards based on the Avago Technologies ADNS-2610 [1] optical flow sensor and extracted from the Logitech M-SBF96 PS2 computer mouse. This sensor presents high reliability for speeds under 30.5 cm/s, and has a register that outputs the SQUAL value, a reference for the quality of the surface. This SQUAL value can be used for calibration and optimization. Figure 1. Pinout of the ADNS-2610 The PCB and lens are attached to a 3D printable structure and assembled with 3 Thorlabs components. Figure 2. Optical sensor Bill of materials (per sensor) The 3D-printed parts have been designed to be printed optimally with an Objet 30 (Polyjet resin printer), but have also been printed with a Form 2 (SLS resin printer). We used the Vero gray resin and the Clear V4 resin with the Objet 30 and the Form 2 respectively. Printer settings were kept at default. Component Quantity Supplier Reference Optical mouse 1 - example link Sensor holder 1 3D printed STEP file , STL file PH75/M 1 Thorlabs link RA180/M 1 Thorlabs link TR75V/M 1 Thorlabs link M3 x 6 mm 2 RS Components link M3 threaded insert 2 RS Components link References [1] ADNS-2610 datasheet","title":"Components"},{"location":"sensors/components/#optical-motion-sensors","text":"","title":"Optical motion sensors"},{"location":"sensors/components/#sensors","text":"To measure the position of the sphere, we used two PCB boards based on the Avago Technologies ADNS-2610 [1] optical flow sensor and extracted from the Logitech M-SBF96 PS2 computer mouse. This sensor presents high reliability for speeds under 30.5 cm/s, and has a register that outputs the SQUAL value, a reference for the quality of the surface. This SQUAL value can be used for calibration and optimization. Figure 1. Pinout of the ADNS-2610 The PCB and lens are attached to a 3D printable structure and assembled with 3 Thorlabs components. Figure 2. Optical sensor","title":"Sensors"},{"location":"sensors/components/#bill-of-materials-per-sensor","text":"The 3D-printed parts have been designed to be printed optimally with an Objet 30 (Polyjet resin printer), but have also been printed with a Form 2 (SLS resin printer). We used the Vero gray resin and the Clear V4 resin with the Objet 30 and the Form 2 respectively. Printer settings were kept at default. Component Quantity Supplier Reference Optical mouse 1 - example link Sensor holder 1 3D printed STEP file , STL file PH75/M 1 Thorlabs link RA180/M 1 Thorlabs link TR75V/M 1 Thorlabs link M3 x 6 mm 2 RS Components link M3 threaded insert 2 RS Components link","title":"Bill of materials (per sensor)"},{"location":"sensors/components/#references","text":"[1] ADNS-2610 datasheet","title":"References"},{"location":"sensors_3050/assembly/","text":"Assembly instructions The PCB and the lens must be removed from the optical mouse. The VDD, GND, MISO, MOSI, NCS and SCLK must be soldered to wires leading to the microcontroller with the microcontroller 3.3V power supply output. The SCLK is the clock selected on the ADNS-3050.h C++ library (in our case 4 MHz, the internal clock divided by 21 of the Arduino DUE used for the SQUAL measurements). The NCS pin allows communication with more than one device by changing the state to HIGH or LOW. The MOSI and MISO pins are to send the data in both directions. Figure 1. Soldered pins on the ADNS-3050 The lens and the PCB are assembled with the PCB holder part 1 and 2 by placing the lens as in Figure 1 and inserting the screws to attach both parts together. Figure 2. ADNS-3050 and lens assembled with the PCB holder. The provided library was created by Tom Wiggins and is available on GitHub [1] and Hackaday [2] . The library has been modified duplicating the functions needed to control and get data from two optical mice. References [1] https://github.com/Tom101222/Adns-3050-Optical-Sensor [2] https://hackaday.io/project/18344-adns-3050-optical-sensor-mouse","title":"Assembly"},{"location":"sensors_3050/assembly/#assembly-instructions","text":"The PCB and the lens must be removed from the optical mouse. The VDD, GND, MISO, MOSI, NCS and SCLK must be soldered to wires leading to the microcontroller with the microcontroller 3.3V power supply output. The SCLK is the clock selected on the ADNS-3050.h C++ library (in our case 4 MHz, the internal clock divided by 21 of the Arduino DUE used for the SQUAL measurements). The NCS pin allows communication with more than one device by changing the state to HIGH or LOW. The MOSI and MISO pins are to send the data in both directions. Figure 1. Soldered pins on the ADNS-3050 The lens and the PCB are assembled with the PCB holder part 1 and 2 by placing the lens as in Figure 1 and inserting the screws to attach both parts together. Figure 2. ADNS-3050 and lens assembled with the PCB holder. The provided library was created by Tom Wiggins and is available on GitHub [1] and Hackaday [2] . The library has been modified duplicating the functions needed to control and get data from two optical mice.","title":"Assembly instructions"},{"location":"sensors_3050/assembly/#references","text":"[1] https://github.com/Tom101222/Adns-3050-Optical-Sensor [2] https://hackaday.io/project/18344-adns-3050-optical-sensor-mouse","title":"References"},{"location":"sensors_3050/characterization/","text":"Characterization Before calibration, the position of the sensor must be adjusted to align with the sphere's equator vertically. Then the horizontal position can be adjusted until a SQUAL value of approximately 50 is achieved. Several recordings of 5 seconds at 1000 Hz were performed to characterize the perimeter measured by the sensor and establish the relationship between the actual and measured perimeter. Two sensors were used, and separate recordings were made rotating the sphere around the yaw and roll axes (Figure 1). Figure 1. SQUAL value recordings for both axes Figure 2. Distribution of the SQUAL values on each axis The results show a homogeneous distribution of the SQUAL value depending on the relative distance change (Figure 3). Figure 3. Relationship between relative displacements and the SQUAL value The calibration was performed by repeating several measurements of one revolution for the roll and yaw axes (n = 6 and n = 5, respectively). For each recording, the sphere has been rotated by hand for one revolution using an external mark. Figure 4. Recordings of absolute displacements in roll and yaw axes of one revolution As shown in Figure 4, for both axes the recordings converge towards a final value. The conversion factor between mouse internal units and sphere displacement is the average of this absolute final value for both axes (n = 11). The average was 21,966 for the roll axis and 20,109 mouse internal units for the yaw axis, giving a final average of 21,038 mouse internal units for a perimeter of 61.89 cm, hence a conversion factor of 339.92 mouse internal units per cm.","title":"Characterization"},{"location":"sensors_3050/characterization/#characterization","text":"Before calibration, the position of the sensor must be adjusted to align with the sphere's equator vertically. Then the horizontal position can be adjusted until a SQUAL value of approximately 50 is achieved. Several recordings of 5 seconds at 1000 Hz were performed to characterize the perimeter measured by the sensor and establish the relationship between the actual and measured perimeter. Two sensors were used, and separate recordings were made rotating the sphere around the yaw and roll axes (Figure 1). Figure 1. SQUAL value recordings for both axes Figure 2. Distribution of the SQUAL values on each axis The results show a homogeneous distribution of the SQUAL value depending on the relative distance change (Figure 3). Figure 3. Relationship between relative displacements and the SQUAL value The calibration was performed by repeating several measurements of one revolution for the roll and yaw axes (n = 6 and n = 5, respectively). For each recording, the sphere has been rotated by hand for one revolution using an external mark. Figure 4. Recordings of absolute displacements in roll and yaw axes of one revolution As shown in Figure 4, for both axes the recordings converge towards a final value. The conversion factor between mouse internal units and sphere displacement is the average of this absolute final value for both axes (n = 11). The average was 21,966 for the roll axis and 20,109 mouse internal units for the yaw axis, giving a final average of 21,038 mouse internal units for a perimeter of 61.89 cm, hence a conversion factor of 339.92 mouse internal units per cm.","title":"Characterization"},{"location":"sensors_3050/components/","text":"Optical motion sensors - option 2, ADNS-3050 Sensors Another option to measure the sphere's position is to use two PCB boards based on the Avago Technologies ADNS-3050 optical flow sensor. The sensor was extracted from the Cougar Minos X2 gaming computer mouse. This sensor has high motion detection under speeds of 152.4 cm/s and can deal with accelerations up to 20G. It has selectable resolutions up to 2000 cpi (we have used the default configuration of 1000 cpi). Furthermore, the register outputs the SQUAL value, which is used for the calibration and adjustment process. Figure 1. Pinout of the ADNS-3050 Bill of materials (per sensor) Component Quantity Supplier Reference Optical mouse 1 - link PCB Holder 1 1 3D printed part STEP file , STL file PCB Holder 2 1 3D printed part STEP file , STL file M3 screws 4 RS Components The rest of the components are the same as described in the ADNS 2610 assembly. Datasheets [1] ADNS-3050 datasheet","title":"Components"},{"location":"sensors_3050/components/#optical-motion-sensors-option-2-adns-3050","text":"","title":"Optical motion sensors - option 2, ADNS-3050"},{"location":"sensors_3050/components/#sensors","text":"Another option to measure the sphere's position is to use two PCB boards based on the Avago Technologies ADNS-3050 optical flow sensor. The sensor was extracted from the Cougar Minos X2 gaming computer mouse. This sensor has high motion detection under speeds of 152.4 cm/s and can deal with accelerations up to 20G. It has selectable resolutions up to 2000 cpi (we have used the default configuration of 1000 cpi). Furthermore, the register outputs the SQUAL value, which is used for the calibration and adjustment process. Figure 1. Pinout of the ADNS-3050","title":"Sensors"},{"location":"sensors_3050/components/#bill-of-materials-per-sensor","text":"Component Quantity Supplier Reference Optical mouse 1 - link PCB Holder 1 1 3D printed part STEP file , STL file PCB Holder 2 1 3D printed part STEP file , STL file M3 screws 4 RS Components The rest of the components are the same as described in the ADNS 2610 assembly.","title":"Bill of materials (per sensor)"},{"location":"sensors_3050/components/#datasheets","text":"[1] ADNS-3050 datasheet","title":"Datasheets"},{"location":"sensors_3360/components/","text":"Components The PMW3360 has exceptional capabilities: high motion detection for speeds up to 635 cm/s and acceleration up to 50G. The register outputs the SQUAL value, a reference of the quality of the surface. The sensor is available for purchase from JACK Enterprises in Tindie [1] . To control it you must download the PWM3360 library [2] . The breakout board has the essential pins available and distributed in a way that makes it easy to connect: VI = 3.3V MI = MISO0 -or- DIN MO = MOSI0 -or- DOUT SC = SCK0 -or- SCK SS = CS0 -or- CS GD = GND The holder can be 3D printed ( STL file and STP file ) and be used with the Thorlabs parts described for the other sensors (ADNS 2610 and 3050). To attach the sensor to the holder, two M2.5 16 mm pan head screws and two M2.5 nuts are needed. The nuts can be pressed to fit on the holder, and the bolts will hold the lens against the sensor without needing glue (Figure 1). Figure 1. 3D printed holder and assembly References [1] https://www.tindie.com/products/jkicklighter/pmw3360-motion-sensor/ [2] https://github.com/SunjunKim/PMW3360","title":"Components"},{"location":"sensors_3360/components/#components","text":"The PMW3360 has exceptional capabilities: high motion detection for speeds up to 635 cm/s and acceleration up to 50G. The register outputs the SQUAL value, a reference of the quality of the surface. The sensor is available for purchase from JACK Enterprises in Tindie [1] . To control it you must download the PWM3360 library [2] . The breakout board has the essential pins available and distributed in a way that makes it easy to connect: VI = 3.3V MI = MISO0 -or- DIN MO = MOSI0 -or- DOUT SC = SCK0 -or- SCK SS = CS0 -or- CS GD = GND The holder can be 3D printed ( STL file and STP file ) and be used with the Thorlabs parts described for the other sensors (ADNS 2610 and 3050). To attach the sensor to the holder, two M2.5 16 mm pan head screws and two M2.5 nuts are needed. The nuts can be pressed to fit on the holder, and the bolts will hold the lens against the sensor without needing glue (Figure 1). Figure 1. 3D printed holder and assembly","title":"Components"},{"location":"sensors_3360/components/#references","text":"[1] https://www.tindie.com/products/jkicklighter/pmw3360-motion-sensor/ [2] https://github.com/SunjunKim/PMW3360","title":"References"},{"location":"wiring/config/","text":"Motor driver configuration The configuration of the stepper motor driver shown below for the position control corresponds to 25,000 steps per revolution on the motor shaft (150,000 steps per revolution on the rotary table): NOTE. To control the closed loop response, we have explored how the different configurations of micro-stepping of the driver DM542A match with the internal units of the optical motion sensor. In the case of the ADNS 2610, the measured average number of internal units per revolution is 9,391 and therefore the best micro stepping configuration is 25,000 steps per revolution. We have evaluated the relationship between the number of steps and the sensor internal units in each possible micro-stepping configuration. The number of steps on the big pulley is 150,000 steps with a gear ratio of 6 between the small and big pulley. Therefore, the number of steps per optical sensor unit is 15.97 steps. This configuration is also the most silent and helps reduce vibrations on the platform. We have used the TeensyStep library [1] which can control stepper motors precisely at high speeds (300,000 steps/s) and accelerations (500,000 steps/s^2). We have implemented a proportional control between the angle measured on the Styrofoam sphere as a set point and the angle of the stepper motor measured from the internal counter of the stepper object using the method stepper.getPosition() [2] . The proportional control uses the method controller.overrideSpeed() to change the rotational speed on the fly. The encoder can be used to record the position separately or implement closed-loop control using the encoder as a position reference. The range of speed and acceleration we have tested with the rotary stage vary from 20 to 100 deg/s and 200 to 1200 deg/s^2. The main loop() execution period on the Teensy 3.5 at 120 MHz is approximately 270 \u00b5s therefore the program execution frequency is higher than 3 kHz where the position of the sensor is evaluated and sent to the stepper motor. Warning If the speed is increased, the system will tend to overshoot. The proportional constant (kp) of the control algorithm might have to be adjusted to get better performance. Using the kp in our code examples, we always got good results. References [1] https://luni64.github.io/TeensyStep/ [2] https://forum.pjrc.com/threads/43491-New-Stepper-Motor-Library/page3","title":"Driver configuration"},{"location":"wiring/config/#motor-driver-configuration","text":"The configuration of the stepper motor driver shown below for the position control corresponds to 25,000 steps per revolution on the motor shaft (150,000 steps per revolution on the rotary table): NOTE. To control the closed loop response, we have explored how the different configurations of micro-stepping of the driver DM542A match with the internal units of the optical motion sensor. In the case of the ADNS 2610, the measured average number of internal units per revolution is 9,391 and therefore the best micro stepping configuration is 25,000 steps per revolution. We have evaluated the relationship between the number of steps and the sensor internal units in each possible micro-stepping configuration. The number of steps on the big pulley is 150,000 steps with a gear ratio of 6 between the small and big pulley. Therefore, the number of steps per optical sensor unit is 15.97 steps. This configuration is also the most silent and helps reduce vibrations on the platform. We have used the TeensyStep library [1] which can control stepper motors precisely at high speeds (300,000 steps/s) and accelerations (500,000 steps/s^2). We have implemented a proportional control between the angle measured on the Styrofoam sphere as a set point and the angle of the stepper motor measured from the internal counter of the stepper object using the method stepper.getPosition() [2] . The proportional control uses the method controller.overrideSpeed() to change the rotational speed on the fly. The encoder can be used to record the position separately or implement closed-loop control using the encoder as a position reference. The range of speed and acceleration we have tested with the rotary stage vary from 20 to 100 deg/s and 200 to 1200 deg/s^2. The main loop() execution period on the Teensy 3.5 at 120 MHz is approximately 270 \u00b5s therefore the program execution frequency is higher than 3 kHz where the position of the sensor is evaluated and sent to the stepper motor. Warning If the speed is increased, the system will tend to overshoot. The proportional constant (kp) of the control algorithm might have to be adjusted to get better performance. Using the kp in our code examples, we always got good results.","title":"Motor driver configuration"},{"location":"wiring/config/#references","text":"[1] https://luni64.github.io/TeensyStep/ [2] https://forum.pjrc.com/threads/43491-New-Stepper-Motor-Library/page3","title":"References"},{"location":"wiring/wiring/","text":"Schematics and electrical connections The device is controlled using a custom PCB which connects the Teensy 3.5 development board with the DM542 stepper motor driver. The board is supplied at 24V and voltage regulators provide a 5V power supply to the Teensy board. In addition, there are two bi-directional logic level shifters (5-3.3V), so up to eight 5V signals can be converted to 3.3V. Connections include two BNC connectors to the Teensy DACs, SPI pins (3.3V) and some extra digital pins at 3.3V. Figure 1. PCB description Figure 2. PCB with components soldered A simplified version of the connections of the setup is shown in Figure 3: Figure 3. Setup connections The emergency stop opens the 24V power supply circuit. The whole experimental device is disconnected if pressed. Warning Before soldering the Emergency stop pins check the continuity between and the logic operation between pins. If the button is pressed, the circuit must be open. Figure 4. Emergency stop connections Bill of materials Component Quantity Supplier Reference PCB 1 - Gerber files Logic Level Converter Module 2 Amazon link Teensy 3.5 microcontroller 1 PJRC link BNC connectors 2 RS Components link 12V voltage regulator L7812CV 1 RS Components link 5V voltage regulator LM7805 1 RS Components link Electrolytic capacitor 330 \u03bcF 25V 1 Ebay link Electrolytic capacitor 47 \u03bcF 50V 1 Ebay link Electrolytic capacitor 1 \u03bcF 50V 1 Ebay link Ceramic capacitor 100 nF 25V 2 RS Components link Ceramic capacitor 330 nF 25V 2 RS Components link Standard female pin headers 6 Amazon link Emergency stop 1 RS Components link Hall efect sensor 1 Amazon link","title":"Connections"},{"location":"wiring/wiring/#schematics-and-electrical-connections","text":"The device is controlled using a custom PCB which connects the Teensy 3.5 development board with the DM542 stepper motor driver. The board is supplied at 24V and voltage regulators provide a 5V power supply to the Teensy board. In addition, there are two bi-directional logic level shifters (5-3.3V), so up to eight 5V signals can be converted to 3.3V. Connections include two BNC connectors to the Teensy DACs, SPI pins (3.3V) and some extra digital pins at 3.3V. Figure 1. PCB description Figure 2. PCB with components soldered A simplified version of the connections of the setup is shown in Figure 3: Figure 3. Setup connections The emergency stop opens the 24V power supply circuit. The whole experimental device is disconnected if pressed. Warning Before soldering the Emergency stop pins check the continuity between and the logic operation between pins. If the button is pressed, the circuit must be open. Figure 4. Emergency stop connections","title":"Schematics and electrical connections"},{"location":"wiring/wiring/#bill-of-materials","text":"Component Quantity Supplier Reference PCB 1 - Gerber files Logic Level Converter Module 2 Amazon link Teensy 3.5 microcontroller 1 PJRC link BNC connectors 2 RS Components link 12V voltage regulator L7812CV 1 RS Components link 5V voltage regulator LM7805 1 RS Components link Electrolytic capacitor 330 \u03bcF 25V 1 Ebay link Electrolytic capacitor 47 \u03bcF 50V 1 Ebay link Electrolytic capacitor 1 \u03bcF 50V 1 Ebay link Ceramic capacitor 100 nF 25V 2 RS Components link Ceramic capacitor 330 nF 25V 2 RS Components link Standard female pin headers 6 Amazon link Emergency stop 1 RS Components link Hall efect sensor 1 Amazon link","title":"Bill of materials"}]}